<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>亚马逊文案违禁词检测工具</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #e47911; /* 亚马逊橙色 */
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        h2 {
            margin-bottom: 15px;
            color: #232f3e; /* 亚马逊深蓝色 */
            font-size: 1.2rem;
        }
        .flex-container {
            display: flex;
            gap: 20px;
        }
        .flex-item {
            flex: 1;
        }
        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        button {
            background-color: #e47911;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #c45500;
        }
        .btn-secondary {
            background-color: #232f3e;
        }
        .btn-secondary:hover {
            background-color: #131921;
        }
        .btn-danger {
            background-color: #d13212;
        }
        .btn-danger:hover {
            background-color: #bf2e0e;
        }
        .word-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .word-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .word-item:last-child {
            border-bottom: none;
        }
        .word-item button {
            padding: 2px 8px;
            font-size: 12px;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .highlight {
            background-color: #ffcccc;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .file-input-container {
            position: relative;
            margin-bottom: 10px;
        }
        .file-input-label {
            display: inline-block;
            background-color: #232f3e;
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .file-input-label:hover {
            background-color: #131921;
        }
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .file-name {
            margin-left: 10px;
            font-size: 14px;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 12px;
            color: #666;
        }
        .instructions {
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .instructions ul {
            margin-left: 20px;
        }
        .tab-container {
            margin-bottom: 15px;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }
        .tab-button {
            padding: 10px 15px;
            background-color: #f1f1f1;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            margin-right: 5px;
        }
        .tab-button.active {
            background-color: #e47911;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }
        .tab-content.active {
            display: block;
        }
        .suggestion {
            margin-top: 5px;
            font-style: italic;
            color: #0066c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>亚马逊文案违禁词检测工具</h1>
        <p style="text-align: center; margin-bottom: 15px; color: #666;">作者：達哥</p>
        
        <div class="instructions">
            <p><strong>使用说明：</strong></p>
            <ul>
                <li>本工具用于检测亚马逊文案中可能存在的违禁词</li>
                <li>您可以使用预设的违禁词库，也可以添加自定义违禁词（支持多行批量添加；自定义词会保存在浏览器本地；单个添加时可选择加入预设库）</li>
                <li>支持直接输入文本或上传TXT文件进行检测</li>
                <li>检测结果会高亮显示发现的违禁词，并统计每个词的命中次数</li>
                <li>替换与导出：
                    <ul style="margin-left: 18px; list-style: circle;">
                        <li>在检测结果下方，可为每个命中词填写替换内容，支持“仅替换此词”和“应用勾选替换”（批量）</li>
                        <li>替换顺序按词长降序，避免短词影响长词；替换后文本实时展示</li>
                        <li>一键“复制替换结果”“导出TXT”“回填到文本输入”，并可“重置为原文”</li>
                    </ul>
                </li>
                <li>匹配与替换规则：
                    <ul style="margin-left: 18px; list-style: circle;">
                        <li>匹配大小写不敏感</li>
                        <li>采用“非字母数字”为边界进行整词匹配</li>
                    </ul>
                </li>
                <li>预设词管理：支持选择/全选/删除预设词</li>
                <li>本工具完全在本地运行，无需联网，可直接分享HTML文件给他人使用</li>
            </ul>
        </div>

        <div class="flex-container">
            <div class="flex-item">
                <div class="section">
                    <h2>违禁词管理</h2>
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-button active" onclick="openTab(event, 'preset-tab')">预设违禁词</button>
                            <button class="tab-button" onclick="openTab(event, 'custom-tab')">自定义违禁词</button>
                        </div>
                        <div id="preset-tab" class="tab-content active">
                            <div class="word-list" id="preset-word-list">
                                <!-- 预设违禁词将在这里显示 -->
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span id="preset-word-count">当前预设词库：0个词</span>
                                <button class="btn-secondary" onclick="toggleAllPresetWords()">全选/取消全选</button>
                            </div>
                        </div>
                        <div id="custom-tab" class="tab-content">
                            <div class="word-list" id="custom-word-list">
                                <!-- 自定义违禁词将在这里显示 -->
                            </div>
                            <div style="margin-bottom: 10px;">
                                <span id="custom-word-count">当前自定义词库：0个词</span>
                            </div>
                            <div>
                                <textarea id="new-word" placeholder="输入新的违禁词（多个词请换行输入）" style="min-height: 80px;"></textarea>
                                <button onclick="addCustomWord()">添加</button>
                                <button class="btn-danger" onclick="clearCustomWords()">清空</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex-item">
                <div class="section">
                    <h2>文案检测</h2>
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-button active" onclick="openTab(event, 'text-tab')">文本输入</button>
                            <button class="tab-button" onclick="openTab(event, 'file-tab')">文件上传</button>
                        </div>
                        <div id="text-tab" class="tab-content active">
                            <textarea id="content-input" placeholder="请输入需要检测的文案内容..."></textarea>
                            <button onclick="checkContent()">检测违禁词</button>
                        </div>
                        <div id="file-tab" class="tab-content">
                            <div class="file-input-container">
                                <label class="file-input-label">
                                    选择文件
                                    <input type="file" id="file-input" class="file-input" accept=".txt">
                                </label>
                                <span class="file-name" id="file-name">未选择文件</span>
                            </div>
                            <button onclick="checkFile()" id="check-file-btn" disabled>检测文件内容</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>检测结果</h2>
            <div class="result" id="result">
                <p>检测结果将在这里显示...</p>
            </div>
        </div>

        <div class="footer">
            <p>亚马逊文案违禁词检测工具 | 本工具仅供参考，请以亚马逊官方规则为准</p>
            <p>版权归 跨境乐趣园所有 官网： <a href="https://amzlink.top/" target="_blank" rel="noopener noreferrer">https://amzlink.top/</a> | 作者：達哥</p>
        </div>
    </div>

    <script>
        // 预设违禁词库
        const presetForbiddenWords = [
            "100% natural",
            "100% quality guaranteed",
            "Acquired Immune Deficiency Syndrome",
            "ADD",
            "added value",
            "ADHD",
            "AIDS",
            "All Natural",
            "ALS",
            "Alzheimers",
            "Antibacterial",
            "Anti-bacterial",
            "antifungal",
            "Anti-Fungal",
            "Anti-Microbial",
            "anxiety",
            "approved",
            "Arrive faster",
            "Attention Deficit Disorder Drug",
            "Authentic",
            "award winning",
            "bacteria",
            "best deal",
            "Best price",
            "Best seller",
            "Best selling",
            "big sale",
            "biodegradable",
            "biological contaminants",
            "bpa free",
            "brand new",
            "buy now",
            "buy with confidence",
            "Cancer",
            "Cancroid",
            "Cataract",
            "certified",
            "Chlamydia",
            "closeout",
            "close-out",
            "CMV",
            "compostable",
            "Concusuion",
            "Coronavirus",
            "covid",
            "COVID-19",
            "Crabs",
            "Crystic Fibrosis",
            "cure",
            "Cytomegalovirus",
            "decomposable",
            "degradable",
            "Dementia",
            "Depression",
            "detoxification",
            "detoxify",
            "Diabetes",
            "Diabetic",
            "Diabetic Neuropathy",
            "Discounted price",
            "disease",
            "diseases",
            "don’t miss out",
            "dotoxifying",
            "eco friendly",
            "ecofriendly",
            "eco-friendly",
            "environmentally friendly",
            "etc.",
            "fall sale",
            "fda",
            "FDA Approval",
            "FedEx",
            "filter",
            "flawless",
            "Flu",
            "free gift",
            "free shipping",
            "On sale",
            "Free shipping Guaranteed",
            "fungal",
            "Fungicide",
            "Fungicides",
            "fungus",
            "gift idea",
            "Glaucoma",
            "Gororrhea",
            "Great as",
            "Great for",
            "green",
            "guarantee",
            "guaranteed",
            "Hassle free",
            "heal",
            "Hepatitis A",
            "Hepatitis B",
            "Hepatitis C",
            "Herpes",
            "Herpes Simplex Virus 1",
            "Herpes Simplex Virus 2",
            "highest rated",
            "HIV",
            "Hodgkins Lymphoma",
            "home compostable",
            "hot item",
            "HPV",
            "HSV1",
            "HSV2",
            "huge sale",
            "Human Immunodeficiency Virus",
            "Human Papiloma Virus",
            "imported from",
            "indian",
            "inflammation",
            "Influenza",
            "Kidney Disease",
            "Lasting quality",
            "LGV",
            "limited time offer",
            "Liver disease",
            "Lupus",
            "Lymphogranuloma Venereum",
            "Lymphoma",
            "Made in",
            "mail rebate",
            "make excellent",
            "makes awesome",
            "makes great",
            "makes perfect",
            "makes spectacular",
            "makes the best",
            "makes wonderful",
            "marine degradable",
            "massive sale",
            "Meningitis",
            "mildew",
            "money back guarantee",
            "Mono",
            "Mononucleosis",
            "mould",
            "mould resistant",
            "mould spores",
            "Multiple Sclerosis",
            "Muscular Dystrophy",
            "Mycoplasma Genitalium",
            "Nano Silver",
            "native american",
            "Native American Indian or tribes",
            "natural",
            "newest version",
            "NGU",
            "non toxic",
            "noncorrosive",
            "Nongonococcal Urethritis",
            "non-toxi",
            "non-toxic",
            "now together",
            "over- stock",
            "overstock",
            "parasitic",
            "Parkinson",
            "Parkinsons",
            "patented",
            "peal",
            "Pelvic Inflammatory Disease",
            "Perfect for",
            "Perfect gift",
            "pesticide",
            "pesticides",
            "PID",
            "platinum",
            "plus free",
            "Professional quality",
            "proven",
            "Public lice",
            "quality",
            "Ready to ship",
            "recommended by",
            "remedies",
            "remedy",
            "Retail box",
            "SAD",
            "sanitize",
            "sanitizes",
            "Satisfaction",
            "Save $",
            "Save cash",
            "Save money",
            "scabies",
            "Seasonal Affective Disorder",
            "seen on tv",
            "Ships faster",
            "shop with confidence",
            "Special offer",
            "Special promo",
            "spring sale",
            "Stroke",
            "summer sale",
            "super sale",
            "supplies won’t last",
            "TBIs",
            "tested",
            "The Clap",
            "Top notch",
            "top quality",
            "top rated",
            "top selling",
            "toxic",
            "toxin",
            "toxins",
            "Traumatic Brain Injuries",
            "treat",
            "treatment",
            "tribes",
            "Trich",
            "trichomoniasis",
            "tricht",
            "Tumor",
            "unbeatable price",
            "UPS",
            "Used",
            "validated",
            "viral",
            "virus",
            "viruses",
            "weight loss",
            "wholesale price",
            "winter sale",
            "Within hours",
            "worlds best",
            "Insecticidal",
            "disinfect",
            "Anti-toxic",
            "repel insects",
            "Anti-mildew",
            "remove allergens",
            "against mildew",
            "drug",
            "dustproof",
            "antibiotic",
            "antifouling",
            "non-poisonous",
            "preservatives",
            "sterilization",
            "mold",
            "insecticide",
            "anti",
            "UV",
            "Antimicrobial",
            "environment friendly",
            "Used to prevent",
            "moisture",
            "Eliminate",
            "infection",
            "Repel or slow down any pest",
            "Anti-oxidation",
            "hygience",
            "Mildew proof",
            "BPA-Free",
            "Bacteriostatic",
            "micro-bio",
            "non-injurious",
            "anti-virus",
            "Anti-Bacterial vinyl",
            "filter air",
            "repelient",
            "resist ultraviolet rays",
            "mosquitos",
            "prevent or inhibit the growth of bacteria",
            "protect",
            "chemical",
            "allergens",
            "hypoallergenic",
            "filters",
            "mites",
            "rat",
            "dust",
            "pest",
            "insect repellent",
            "rodent",
            "insects",
            "mouse",
            "pests",
            "harmless",
            "Water filtration",
            "Anti-Mites",
            "Inhibit-Algae",
            "Sanitize-Blight",
            "Sterilize",
            "Insect prevention",
            "Resistant for mosquitoes & ants",
            "Nontoxic",
            "Healthy",
            "Environmental Protection.",
            "Anti-Fouling",
            "prevent",
            "resistant",
            "Anti-flu",
            "Ultraviolet",
            "light/UV",
            "germs",
            "bug",
            "Anti-Bacteria",
            "Stop-Microbe/Mildew",
            "Destroy",
            "Fungal/Fungus",
            "Repel-Pesticides",
            "preventing",
            "destroying",
            "repelling",
            "mitigating any pest",
            "anti-mold",
            "odourless",
            "safety",
            "remove",
            "residue",
            "100%",
            "we",
            "our",
            "ours"
        ];

        // 用户自定义违禁词库
        let customForbiddenWords = [];

        // 当前选中的预设违禁词
        let selectedPresetWords = [...presetForbiddenWords];

        // 最近一次检测的原文与替换结果
        let lastCheckedContent = '';
        let lastModifiedContent = '';

        // 工具函数：转义正则特殊字符，确保正则匹配安全
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        // 新增：按英文/数字边界匹配，避免从 your 中误匹配 our 等子串
        function createBoundaryRegex(word, flags = 'gi') {
            const escaped = escapeRegExp(word);
            // 使用“非字母数字”作为边界，等价于整词，但允许短语/符号存在
            // (^|[^A-Za-z0-9]) (word) (?=$|[^A-Za-z0-9])
            const pattern = `(^|[^A-Za-z0-9])(${escaped})(?=$|[^A-Za-z0-9])`;
            return new RegExp(pattern, flags);
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化预设违禁词列表
            initPresetWordList();
            
            // 从本地存储加载自定义违禁词
            loadCustomWords();
            
            // 初始化文件上传监听
            document.getElementById('file-input').addEventListener('change', function(e) {
                const fileName = e.target.files[0] ? e.target.files[0].name : '未选择文件';
                document.getElementById('file-name').textContent = fileName;
                document.getElementById('check-file-btn').disabled = !e.target.files[0];
            });
        });

        // 初始化预设违禁词列表
        function initPresetWordList() {
            const wordList = document.getElementById('preset-word-list');
            wordList.innerHTML = '';
            
            // 更新预设词库数量统计
            document.getElementById('preset-word-count').textContent = `当前预设词库：${presetForbiddenWords.length}个词`;
            
            presetForbiddenWords.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = selectedPresetWords.includes(word);
                checkbox.onchange = function() {
                    if (this.checked) {
                        if (!selectedPresetWords.includes(word)) {
                            selectedPresetWords.push(word);
                        }
                    } else {
                        const index = selectedPresetWords.indexOf(word);
                        if (index !== -1) {
                            selectedPresetWords.splice(index, 1);
                        }
                    }
                };
                
                const wordText = document.createElement('span');
                wordText.textContent = word;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-danger';
                deleteBtn.textContent = '删除';
                deleteBtn.style.marginLeft = '5px';
                deleteBtn.onclick = function() {
                    if (confirm(`确定要从预设库中删除「${word}」吗？`)) {
                        const index = presetForbiddenWords.indexOf(word);
                        if (index !== -1) {
                            presetForbiddenWords.splice(index, 1);
                            // 如果该词在选中列表中，也需要移除
                            const selectedIndex = selectedPresetWords.indexOf(word);
                            if (selectedIndex !== -1) {
                                selectedPresetWords.splice(selectedIndex, 1);
                            }
                            initPresetWordList();
                        }
                    }
                };
                
                wordItem.appendChild(checkbox);
                wordItem.appendChild(wordText);
                wordItem.appendChild(deleteBtn);
                wordList.appendChild(wordItem);
            });
        }

        // 全选/取消全选预设违禁词
        function toggleAllPresetWords() {
            const checkboxes = document.querySelectorAll('#preset-word-list input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => {
                cb.checked = !allChecked;
                const word = cb.nextElementSibling.textContent;
                
                if (!allChecked) { // 全选
                    if (!selectedPresetWords.includes(word)) {
                        selectedPresetWords.push(word);
                    }
                } else { // 取消全选
                    const index = selectedPresetWords.indexOf(word);
                    if (index !== -1) {
                        selectedPresetWords.splice(index, 1);
                    }
                }
            });
        }

        // 加载自定义违禁词
        function loadCustomWords() {
            const savedWords = localStorage.getItem('customForbiddenWords');
            if (savedWords) {
                customForbiddenWords = JSON.parse(savedWords);
                updateCustomWordList();
            }
        }

        // 保存自定义违禁词到本地存储
        function saveCustomWords() {
            localStorage.setItem('customForbiddenWords', JSON.stringify(customForbiddenWords));
        }

        // 更新自定义违禁词列表显示
        function updateCustomWordList() {
            const wordList = document.getElementById('custom-word-list');
            wordList.innerHTML = '';
            
            // 更新自定义词库数量统计
            document.getElementById('custom-word-count').textContent = `当前自定义词库：${customForbiddenWords.length}个词`;
            
            if (customForbiddenWords.length === 0) {
                const emptyMsg = document.createElement('p');
                emptyMsg.textContent = '暂无自定义违禁词，请在下方添加';
                emptyMsg.style.color = '#999';
                wordList.appendChild(emptyMsg);
                return;
            }
            
            customForbiddenWords.forEach((word, index) => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';
                
                const wordText = document.createElement('span');
                wordText.textContent = word;
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-danger';
                deleteBtn.textContent = '删除';
                deleteBtn.onclick = function() {
                    customForbiddenWords.splice(index, 1);
                    saveCustomWords();
                    updateCustomWordList();
                };
                
                wordItem.appendChild(wordText);
                wordItem.appendChild(deleteBtn);
                wordList.appendChild(wordItem);
            });
        }

        // 清空自定义违禁词
        function clearCustomWords() {
            if (confirm('确定要清空所有自定义违禁词吗？')) {
                customForbiddenWords = [];
                saveCustomWords();
                updateCustomWordList();
                // 清空输入框
                document.getElementById('new-word').value = '';
            }
        }

        // 添加自定义违禁词
        function addCustomWord() {
            const input = document.getElementById('new-word');
            const inputText = input.value.trim();
            
            if (inputText) {
                // 按行分割输入的文本，处理多个词的情况
                const words = inputText.split('\n').filter(w => w.trim() !== '');
                
                if (words.length === 0) {
                    alert('请输入违禁词！');
                    return;
                }
                
                // 如果只有一个词，按原来的逻辑处理
                if (words.length === 1) {
                    const word = words[0];
                    // 检查是否已存在于自定义词库（不区分大小写）
                    if (!customForbiddenWords.some(item => item.toLowerCase() === word.toLowerCase())) {
                        // 检查是否已存在于预设词库（不区分大小写）
                        if (presetForbiddenWords.some(item => item.toLowerCase() === word.toLowerCase())) {
                            alert('该违禁词已存在于预设库中！');
                        } else {
                            // 询问用户是否要添加到预设库
                            const addToPreset = confirm(`是否将「${word}」添加到预设违禁词库？\n- 点击"确定"将添加到预设库\n- 点击"取消"将仅添加到自定义库`);
                            
                            if (addToPreset) {
                                // 添加到预设库
                                presetForbiddenWords.push(word);
                                selectedPresetWords.push(word);
                                initPresetWordList();
                                alert('添加成功！该词已添加到预设违禁词库。');
                            } else {
                                // 仅添加到自定义库
                                customForbiddenWords.push(word);
                                saveCustomWords();
                                updateCustomWordList();
                            }
                            input.value = '';
                        }
                    } else {
                        alert('该违禁词已存在于自定义库中！');
                    }
                } else {
                    // 多个词的情况，直接添加到自定义库
                    let addedCount = 0;
                    let existingCount = 0;
                    let presetCount = 0;
                    
                    words.forEach(word => {
                        // 检查是否已存在于自定义词库（不区分大小写）
                        if (customForbiddenWords.some(item => item.toLowerCase() === word.toLowerCase())) {
                            existingCount++;
                        // 检查是否已存在于预设词库（不区分大小写）
                        } else if (presetForbiddenWords.some(item => item.toLowerCase() === word.toLowerCase())) {
                            presetCount++;
                        } else {
                            customForbiddenWords.push(word);
                            addedCount++;
                        }
                    });
                    
                    saveCustomWords();
                    updateCustomWordList();
                    
                    let message = `成功添加了 ${addedCount} 个违禁词到自定义库。`;
                    if (existingCount > 0) {
                        message += `\n${existingCount} 个词已存在于自定义库中。`;
                    }
                    if (presetCount > 0) {
                        message += `\n${presetCount} 个词已存在于预设库中。`;
                    }
                    
                    alert(message);
                    input.value = '';
                }
            } else {
                alert('请输入违禁词！');
            }
        }

        // 检测文本内容
        function checkContent() {
            const content = document.getElementById('content-input').value.trim();
            if (!content) {
                alert('请输入需要检测的文案内容！');
                return;
            }
            
            performCheck(content);
        }

        // 检测文件内容
        function checkFile() {
            const fileInput = document.getElementById('file-input');
            if (!fileInput.files[0]) {
                alert('请选择要检测的文件！');
                return;
            }
            
            const file = fileInput.files[0];
            if (file.type !== 'text/plain' && !file.name.endsWith('.txt')) {
                alert('请选择TXT文本文件！');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                performCheck(content);
            };
            reader.onerror = function() {
                alert('文件读取失败，请重试！');
            };
            reader.readAsText(file);
        }

        // 执行检测
        function performCheck(content) {
            // 保存原文与初始化替换文本
            lastCheckedContent = content;
            lastModifiedContent = content;

            // 合并选中的预设违禁词和自定义违禁词
            const allForbiddenWords = [...selectedPresetWords, ...customForbiddenWords];
            
            if (allForbiddenWords.length === 0) {
                alert('请至少选择或添加一个违禁词！');
                return;
            }
            
            // 找出所有违禁词出现的位置和次数（不区分大小写），并去重
            const foundItems = [];
            allForbiddenWords.forEach(word => {
                const regex = createBoundaryRegex(word, 'gi');
                let count = 0;
                let m;
                while ((m = regex.exec(content)) !== null) {
                    // 防止零宽匹配死循环
                    if (m.index === regex.lastIndex) regex.lastIndex++;
                    count++;
                }
                if (count > 0) {
                    foundItems.push({ word, count });
                }
            });
            
            // 显示检测结果
            const resultDiv = document.getElementById('result');
            
            if (foundItems.length === 0) {
                resultDiv.innerHTML = '<p style="color: green;">✓ 恭喜！未发现任何违禁词。</p>';
                return;
            }
            
            // 按长度降序，避免替换时词间相互影响
            foundItems.sort((a, b) => b.word.length - a.word.length);
            
            // 高亮显示违禁词（仅高亮第二个捕获组：实际命中的词本身）
            let highlightedContent = content;
            foundItems.forEach(item => {
                const regex = createBoundaryRegex(item.word, 'gi');
                highlightedContent = highlightedContent.replace(regex, (match, p1, p2) => `${p1}<span class="highlight">${p2}</span>`);
            });
            
            // 生成修改建议
            const suggestions = foundItems.map(item => {
                return `<li><strong>${item.word}</strong>（${item.count}处） - 建议替换为更中性的描述，避免使用绝对化、夸大的表述</li>`;
            }).join('');

            // 生成替换面板
            const replaceListHtml = foundItems.map((item) => {
                const safeWordForAttr = item.word.replace(/'/g, "\\'");
                return `
                <div class="word-item" style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" class="replace-select" data-word="${item.word}" checked>
                    <span style="min-width: 200px;">${item.word} <span style="color:#999;">(共${item.count}处)</span></span>
                    <input type="text" class="replace-input" data-word="${item.word}" placeholder="替换为..." style="flex:1; padding:6px;">
                    <button class="btn-secondary" onclick="applySingleReplacement('${safeWordForAttr}')">仅替换此词</button>
                </div>`;
            }).join('');
            
            resultDiv.innerHTML = `
                <p style="color: red;">⚠ 检测到 ${foundItems.length} 个违禁词：</p>
                <div style="margin: 10px 0; padding: 10px; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; white-space: pre-wrap;">${highlightedContent}</div>
                <div class="suggestion">
                    <p><strong>修改建议：</strong></p>
                    <ul>${suggestions}</ul>
                </div>
                <hr style="margin:12px 0;">
                <div class="section" style="margin-top:10px;">
                    <h3 style="margin-bottom:8px;">替换与导出</h3>
                    <div id="replace-list" class="word-list" style="max-height:260px;">${replaceListHtml}</div>
                    <div style="display:flex; gap:8px; flex-wrap: wrap; margin: 8px 0;">
                        <button onclick="applyBatchReplacements()">应用勾选替换</button>
                        <button class="btn-secondary" onclick="resetModified()">重置为原文</button>
                    </div>
                    <div>
                        <h4 style="margin:8px 0;">替换后文本</h4>
                        <textarea id="modified-output" readonly style="width:100%; min-height:140px;"></textarea>
                        <div style="display:flex; gap:8px; flex-wrap: wrap; margin-top:8px;">
                            <button onclick="copyModified()">复制替换结果</button>
                            <button onclick="exportModified()">导出TXT</button>
                            <button onclick="fillBackModified()">回填到文本输入</button>
                        </div>
                    </div>
                </div>
            `;

            // 初始化替换结果显示
            updateModifiedOutput();
        }

        // 将单个词的替换应用到当前替换文本
        function applySingleReplacement(word) {
            // 获取对应输入框的替换内容
            const inputs = document.querySelectorAll('.replace-input');
            let replacement = '';
            inputs.forEach(input => {
                if (input.getAttribute('data-word') === word) {
                    replacement = input.value;
                }
            });
            if (!replacement) {
                alert(`请先为「${word}」输入替换内容`);
                return;
            }
            const regex = createBoundaryRegex(word, 'gi');
            lastModifiedContent = lastModifiedContent.replace(regex, (match, p1, p2) => p1 + replacement);
            updateModifiedOutput();
        }

        // 批量应用勾选的替换
        function applyBatchReplacements() {
            const pairs = [];
            const selects = document.querySelectorAll('.replace-select');
            selects.forEach(cb => {
                if (cb.checked) {
                    const w = cb.getAttribute('data-word');
                    // 找到对应的输入框
                    let r = '';
                    document.querySelectorAll('.replace-input').forEach(inp => {
                        if (inp.getAttribute('data-word') === w) {
                            r = inp.value;
                        }
                    });
                    if (r) {
                        pairs.push({ w, r });
                    }
                }
            });
            if (pairs.length === 0) {
                alert('请至少勾选一个要替换的词，并填写替换内容');
                return;
            }
            // 按词长度降序，避免替换时产生串扰
            pairs.sort((a, b) => b.w.length - a.w.length);
            let content = lastModifiedContent;
            pairs.forEach(({ w, r }) => {
                const regex = createBoundaryRegex(w, 'gi');
                content = content.replace(regex, (match, p1, p2) => p1 + r);
            });
            lastModifiedContent = content;
            updateModifiedOutput();
        }

        function updateModifiedOutput() {
            const out = document.getElementById('modified-output');
            if (out) out.value = lastModifiedContent;
        }

        function resetModified() {
            lastModifiedContent = lastCheckedContent;
            updateModifiedOutput();
        }

        function copyModified() {
            const text = lastModifiedContent || '';
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('已复制到剪贴板');
                }).catch(() => {
                    fallbackCopy();
                });
            } else {
                fallbackCopy();
            }
            function fallbackCopy() {
                const ta = document.getElementById('modified-output');
                if (!ta) return;
                ta.removeAttribute('readonly');
                ta.select();
                document.execCommand('copy');
                ta.setAttribute('readonly', 'readonly');
                alert('已复制到剪贴板');
            }
        }

        function exportModified() {
            const text = lastModifiedContent || '';
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'modified.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function fillBackModified() {
            const ta = document.getElementById('content-input');
            if (ta) {
                ta.value = lastModifiedContent || '';
                ta.focus();
            }
        }

        // 切换标签页
        function openTab(evt, tabId) {
            // 隐藏所有标签内容
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // 取消所有标签按钮的活动状态
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            // 显示当前标签内容并激活按钮
            document.getElementById(tabId).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
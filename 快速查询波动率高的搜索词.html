<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€ŸæŸ¥è¯¢æ³¢åŠ¨ç‡é«˜çš„æœç´¢è¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }

        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .author-info {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .author-info span {
            color: #667eea;
            font-weight: 600;
        }

        .qrcode-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .qrcode-wrapper {
            text-align: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .qrcode-wrapper img {
            width: 200px;
            height: 200px;
            border-radius: 8px;
            border: 3px solid #667eea;
        }

        .qrcode-label {
            margin-top: 12px;
            color: #667eea;
            font-weight: 600;
            font-size: 14px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .file-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }

        .file-list {
            margin-top: 15px;
            text-align: left;
        }

        .file-item {
            background: white;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
        }

        .file-item button {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .file-item button:hover {
            background: #c82333;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-suffix {
            display: flex;
            align-items: center;
        }

        .input-suffix input {
            flex: 1;
            border-radius: 6px 0 0 6px;
        }

        .input-suffix span {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 0 6px 6px 0;
            font-weight: 500;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102,126,234,0.4);
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            margin-top: 30px;
            display: none;
        }

        .result-section.active {
            display: block;
        }

        .export-btn {
            background: #28a745;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 13px;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin: 2px;
            white-space: nowrap;
        }

        .tag-new {
            background: #d4edda;
            color: #155724;
        }

        .tag-lost {
            background: #f8d7da;
            color: #721c24;
        }

        .tag-aba-up {
            background: #d4edda;
            color: #155724;
        }

        .tag-aba-down {
            background: #f8d7da;
            color: #721c24;
        }

        .tag-click-up {
            background: #d1ecf1;
            color: #0c5460;
        }

        .tag-click-down {
            background: #fff3cd;
            color: #856404;
        }

        .tag-convert-up {
            background: #e2d9f3;
            color: #4a235a;
        }

        .tag-convert-down {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 500;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .summary {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .summary h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .summary p {
            color: #666;
            line-height: 1.8;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” å¿«é€ŸæŸ¥è¯¢æ³¢åŠ¨ç‡é«˜çš„æœç´¢è¯</h1>
            <div class="author-info">
                ä½œè€…å…¬ä¼—å·ï¼š<span>å¿…èƒœå“¥çš„ä¸‰æ¿æ–§</span>
            </div>
            <div class="qrcode-container">
                <div class="qrcode-wrapper">
                    <img src="https://tc.z.wiki/autoupload/edKd7EnrdtB-UwY97x0oKsS6MvGWw9YIYwMnL2_E4yayl5f0KlZfm6UsKj-HyTuv/20250705/KWaE/430X430/qrcode_for_gh_3938b401b10d_430.jpg" alt="å…¬ä¼—å·äºŒç»´ç ">
                    <div class="qrcode-label">æ‰«ç å…³æ³¨å…¬ä¼—å·</div>
                </div>
            </div>
        </div>

        <div class="upload-section">
            <h3 style="margin-bottom: 15px; color: #333;">ğŸ“ ä¸Šä¼ CSVæ–‡ä»¶</h3>
            <div class="file-input-wrapper">
                <input type="file" id="csvFiles" accept=".csv" multiple>
                <label for="csvFiles" class="file-label">é€‰æ‹©CSVæ–‡ä»¶</label>
            </div>
            <div class="file-list" id="fileList"></div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label>ABAæ’åå˜åŒ–æ¯”ä¾‹</label>
                <div class="input-suffix">
                    <input type="number" id="abaThreshold" value="20" min="0" step="1">
                    <span>%</span>
                </div>
            </div>
            <div class="input-group">
                <label>å‰ä¸‰ç‚¹å‡»ä»½é¢å˜åŒ–æ¯”ä¾‹</label>
                <div class="input-suffix">
                    <input type="number" id="clickThreshold" value="20" min="0" step="1">
                    <span>%</span>
                </div>
            </div>
            <div class="input-group">
                <label>å‰ä¸‰è½¬åŒ–é¢å˜åŒ–æ¯”ä¾‹</label>
                <div class="input-suffix">
                    <input type="number" id="convertThreshold" value="20" min="0" step="1">
                    <span>%</span>
                </div>
            </div>
        </div>

        <button class="analyze-btn" id="analyzeBtn" disabled>å¼€å§‹åˆ†æ</button>

        <div class="result-section" id="resultSection">
            <button class="export-btn" id="exportBtn">ğŸ“¥ å¯¼å‡ºä¸ºCSV</button>
            <div id="summary" class="summary"></div>
            <div class="table-wrapper">
                <table id="resultTable">
                    <thead id="tableHeader">
                        <!-- è¡¨å¤´å°†åŠ¨æ€ç”Ÿæˆ -->
                    </thead>
                    <tbody id="resultBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let analysisResults = [];
        let oldDate = '';
        let newDate = '';

        document.getElementById('csvFiles').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            uploadedFiles = uploadedFiles.concat(files);
            updateFileList();
            updateAnalyzeButton();
        });

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>ğŸ“„ ${file.name} (${(file.size / 1024).toFixed(2)} KB)</span>
                    <button onclick="removeFile(${index})">åˆ é™¤</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            updateAnalyzeButton();
        }

        function updateAnalyzeButton() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = uploadedFiles.length < 2;
        }

        document.getElementById('analyzeBtn').addEventListener('click', analyzeData);

        async function analyzeData() {
            const abaThreshold = parseFloat(document.getElementById('abaThreshold').value) / 100;
            const clickThreshold = parseFloat(document.getElementById('clickThreshold').value) / 100;
            const convertThreshold = parseFloat(document.getElementById('convertThreshold').value) / 100;

            if (uploadedFiles.length < 2) {
                alert('è¯·è‡³å°‘ä¸Šä¼ 2ä¸ªCSVæ–‡ä»¶è¿›è¡Œå¯¹æ¯”åˆ†æ');
                return;
            }

            try {
                const allData = await Promise.all(uploadedFiles.map(file => parseCSV(file)));
                
                // æŒ‰æ—¥æœŸæ’åº
                allData.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const oldData = allData[0];
                const newData = allData[allData.length - 1];

                // ä¿å­˜æ—¥æœŸä¾›åç»­ä½¿ç”¨
                oldDate = oldData.date;
                newDate = newData.date;

                analysisResults = performAnalysis(oldData, newData, abaThreshold, clickThreshold, convertThreshold);
                
                displayResults(analysisResults, oldDate, newDate);
            } catch (error) {
                alert('åˆ†æè¿‡ç¨‹ä¸­å‡ºé”™: ' + error.message);
                console.error(error);
            }
        }

        function parseCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const text = e.target.result;
                        const lines = text.split('\n').filter(line => line.trim());
                        
                        // åˆ é™¤ç¬¬ä¸€è¡Œ
                        lines.shift();
                        
                        if (lines.length < 2) {
                            reject(new Error('CSVæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®'));
                            return;
                        }

                        const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        const data = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            const values = parseCSVLine(lines[i]);
                            const row = {};
                            
                            headers.forEach((header, index) => {
                                row[header] = values[index] ? values[index].trim().replace(/"/g, '') : '';
                            });
                            
                            // è®¡ç®—å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œå’Œå‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ
                            const click1 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #1ï¼šç‚¹å‡»ä»½é¢']) || 0;
                            const click2 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #2ï¼šç‚¹å‡»ä»½é¢']) || 0;
                            const click3 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #3ï¼šç‚¹å‡»ä»½é¢']) || 0;
                            row['å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œ'] = click1 + click2 + click3;
                            
                            const convert1 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #1ï¼šè½¬åŒ–ä»½é¢']) || 0;
                            const convert2 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #2ï¼šè½¬åŒ–ä»½é¢']) || 0;
                            const convert3 = parseFloat(row['ç‚¹å‡»é‡æœ€é«˜çš„å•†å“ #3ï¼šè½¬åŒ–ä»½é¢']) || 0;
                            row['å‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ'] = convert1 + convert2 + convert3;
                            
                            data.push(row);
                        }
                        
                        // è·å–æŠ¥å‘Šæ—¥æœŸ
                        const date = data[0]['æŠ¥å‘Šæ—¥æœŸ'] || '';
                        
                        resolve({ data, date });
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = () => reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
                reader.readAsText(file, 'UTF-8');
            });
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            
            return result;
        }

        function performAnalysis(oldData, newData, abaThreshold, clickThreshold, convertThreshold) {
            const results = [];
            const oldMap = new Map();
            const newMap = new Map();
            
            oldData.data.forEach(row => {
                oldMap.set(row['æœç´¢è¯'], row);
            });
            
            newData.data.forEach(row => {
                newMap.set(row['æœç´¢è¯'], row);
            });
            
            // æ£€æŸ¥æ–°å¢æœç´¢è¯
            newMap.forEach((row, keyword) => {
                if (!oldMap.has(keyword)) {
                    results.push({
                        tags: ['æ–°å¢æœç´¢è¯'],
                        keyword: keyword,
                        oldRank: '-',
                        newRank: row['æœç´¢é¢‘ç‡æ’å'],
                        oldClick: '-',
                        newClick: row['å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œ'].toFixed(2),
                        oldConvert: '-',
                        newConvert: row['å‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ'].toFixed(2)
                    });
                }
            });
            
            // æ£€æŸ¥ä¸¢å¤±æœç´¢è¯
            oldMap.forEach((row, keyword) => {
                if (!newMap.has(keyword)) {
                    results.push({
                        tags: ['ä¸¢å¤±æœç´¢è¯'],
                        keyword: keyword,
                        oldRank: row['æœç´¢é¢‘ç‡æ’å'],
                        newRank: '-',
                        oldClick: row['å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œ'].toFixed(2),
                        newClick: '-',
                        oldConvert: row['å‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ'].toFixed(2),
                        newConvert: '-'
                    });
                }
            });
            
            // æ£€æŸ¥å…±åŒæœç´¢è¯çš„å˜åŒ–
            oldMap.forEach((oldRow, keyword) => {
                if (newMap.has(keyword)) {
                    const newRow = newMap.get(keyword);
                    const tags = [];
                    
                    const oldRank = parseFloat(oldRow['æœç´¢é¢‘ç‡æ’å']) || 0;
                    const newRank = parseFloat(newRow['æœç´¢é¢‘ç‡æ’å']) || 0;
                    const oldClick = oldRow['å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œ'] || 0;
                    const newClick = newRow['å‰ä¸‰ç‚¹å‡»ä»½é¢ä¹‹å’Œ'] || 0;
                    const oldConvert = oldRow['å‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ'] || 0;
                    const newConvert = newRow['å‰ä¸‰è½¬åŒ–ä»½é¢ä¹‹å’Œ'] || 0;
                    
                    // ABAæ’åå˜åŒ– (æ’åæ•°å­—è¶Šå°è¶Šé å‰ï¼Œæ‰€ä»¥è´Ÿæ•°ä»£è¡¨ä¸Šæ¶¨)
                    if (oldRank > 0) {
                        const abaChange = (newRank - oldRank) / oldRank;
                        if (Math.abs(abaChange) > abaThreshold) {
                            if (abaChange < 0) {
                                tags.push('ABAå¤§å¹…ä¸Šæ¶¨');
                            } else {
                                tags.push('ABAå¤§å¹…ä¸‹è·Œ');
                            }
                        }
                    }
                    
                    // å‰ä¸‰ç‚¹å‡»ä»½é¢å˜åŒ–
                    if (oldClick > 0) {
                        const clickChange = (newClick - oldClick) / oldClick;
                        if (Math.abs(clickChange) > clickThreshold) {
                            if (clickChange < 0) {
                                tags.push('å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸‹é™');
                            } else {
                                tags.push('å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸Šæ¶¨');
                            }
                        }
                    }
                    
                    // å‰ä¸‰è½¬åŒ–ä»½é¢å˜åŒ–
                    if (oldConvert > 0) {
                        const convertChange = (newConvert - oldConvert) / oldConvert;
                        if (Math.abs(convertChange) > convertThreshold) {
                            if (convertChange < 0) {
                                tags.push('å‰ä¸‰è½¬åŒ–ä»½é¢ä¸‹é™');
                            } else {
                                tags.push('å‰ä¸‰è½¬åŒ–ä»½é¢ä¸Šæ¶¨');
                            }
                        }
                    }
                    
                    if (tags.length > 0) {
                        results.push({
                            tags: tags,
                            keyword: keyword,
                            oldRank: oldRank,
                            newRank: newRank,
                            oldClick: oldClick.toFixed(2),
                            newClick: newClick.toFixed(2),
                            oldConvert: oldConvert.toFixed(2),
                            newConvert: newConvert.toFixed(2)
                        });
                    }
                }
            });
            
            return results;
        }

        function displayResults(results, oldDate, newDate) {
            const resultSection = document.getElementById('resultSection');
            const tableHeader = document.getElementById('tableHeader');
            const resultBody = document.getElementById('resultBody');
            const summary = document.getElementById('summary');
            
            // åŠ¨æ€ç”Ÿæˆè¡¨å¤´,ä½¿ç”¨å®é™…æ—¥æœŸ
            tableHeader.innerHTML = `
                <tr>
                    <th>è¾“å‡ºæ ‡è®°</th>
                    <th>æœç´¢è¯</th>
                    <th>${oldDate}-æœç´¢é¢‘ç‡æ’å</th>
                    <th>${newDate}-æœç´¢é¢‘ç‡æ’å</th>
                    <th>${oldDate}-å‰ä¸‰ç‚¹å‡»ä»½é¢</th>
                    <th>${newDate}-å‰ä¸‰ç‚¹å‡»ä»½é¢</th>
                    <th>${oldDate}-å‰ä¸‰è½¬åŒ–ä»½é¢</th>
                    <th>${newDate}-å‰ä¸‰è½¬åŒ–ä»½é¢</th>
                </tr>
            `;
            
            resultBody.innerHTML = '';
            
            // ç”Ÿæˆæ‘˜è¦
            const newCount = results.filter(r => r.tags.includes('æ–°å¢æœç´¢è¯')).length;
            const lostCount = results.filter(r => r.tags.includes('ä¸¢å¤±æœç´¢è¯')).length;
            const abaUpCount = results.filter(r => r.tags.includes('ABAå¤§å¹…ä¸Šæ¶¨')).length;
            const abaDownCount = results.filter(r => r.tags.includes('ABAå¤§å¹…ä¸‹è·Œ')).length;
            const clickUpCount = results.filter(r => r.tags.includes('å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸Šæ¶¨')).length;
            const clickDownCount = results.filter(r => r.tags.includes('å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸‹é™')).length;
            const convertUpCount = results.filter(r => r.tags.includes('å‰ä¸‰è½¬åŒ–ä»½é¢ä¸Šæ¶¨')).length;
            const convertDownCount = results.filter(r => r.tags.includes('å‰ä¸‰è½¬åŒ–ä»½é¢ä¸‹é™')).length;
            
            summary.innerHTML = `
                <h3>ğŸ“Š åˆ†ææ‘˜è¦</h3>
                <p><strong>å¯¹æ¯”æ—¶é—´æ®µï¼š</strong>${oldDate} â†’ ${newDate}</p>
                <p><strong>æ£€æµ‹åˆ°çš„å˜åŒ–ï¼š</strong></p>
                <p>ğŸ†• æ–°å¢æœç´¢è¯: ${newCount} ä¸ª</p>
                <p>âŒ ä¸¢å¤±æœç´¢è¯: ${lostCount} ä¸ª</p>
                <p>ğŸ“ˆ ABAå¤§å¹…ä¸Šæ¶¨: ${abaUpCount} ä¸ª | ğŸ“‰ ABAå¤§å¹…ä¸‹è·Œ: ${abaDownCount} ä¸ª</p>
                <p>ğŸ‘† å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸Šæ¶¨: ${clickUpCount} ä¸ª | ğŸ‘‡ å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸‹é™: ${clickDownCount} ä¸ª</p>
                <p>ğŸ’° å‰ä¸‰è½¬åŒ–ä»½é¢ä¸Šæ¶¨: ${convertUpCount} ä¸ª | ğŸ’” å‰ä¸‰è½¬åŒ–ä»½é¢ä¸‹é™: ${convertDownCount} ä¸ª</p>
                <p><strong>å…±å‘ç° ${results.length} ä¸ªéœ€è¦å…³æ³¨çš„æœç´¢è¯</strong></p>
            `;
            
            results.forEach(result => {
                const row = document.createElement('tr');
                
                const tagsHtml = result.tags.map(tag => {
                    let className = 'tag';
                    if (tag === 'æ–°å¢æœç´¢è¯') className += ' tag-new';
                    else if (tag === 'ä¸¢å¤±æœç´¢è¯') className += ' tag-lost';
                    else if (tag === 'ABAå¤§å¹…ä¸Šæ¶¨') className += ' tag-aba-up';
                    else if (tag === 'ABAå¤§å¹…ä¸‹è·Œ') className += ' tag-aba-down';
                    else if (tag === 'å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸Šæ¶¨') className += ' tag-click-up';
                    else if (tag === 'å‰ä¸‰ç‚¹å‡»ä»½é¢ä¸‹é™') className += ' tag-click-down';
                    else if (tag === 'å‰ä¸‰è½¬åŒ–ä»½é¢ä¸Šæ¶¨') className += ' tag-convert-up';
                    else if (tag === 'å‰ä¸‰è½¬åŒ–ä»½é¢ä¸‹é™') className += ' tag-convert-down';
                    return `<span class="${className}">${tag}</span>`;
                }).join('');
                
                row.innerHTML = `
                    <td>${tagsHtml}</td>
                    <td><strong>${result.keyword}</strong></td>
                    <td>${result.oldRank}</td>
                    <td>${result.newRank}</td>
                    <td>${result.oldClick}</td>
                    <td>${result.newClick}</td>
                    <td>${result.oldConvert}</td>
                    <td>${result.newConvert}</td>
                `;
                resultBody.appendChild(row);
            });
            
            resultSection.classList.add('active');
        }

        document.getElementById('exportBtn').addEventListener('click', function() {
            if (analysisResults.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }
            
            let csv = '\ufeff'; // UTF-8 BOM
            csv += `è¾“å‡ºæ ‡è®°,æœç´¢è¯,${oldDate}-æœç´¢é¢‘ç‡æ’å,${newDate}-æœç´¢é¢‘ç‡æ’å,${oldDate}-å‰ä¸‰ç‚¹å‡»ä»½é¢,${newDate}-å‰ä¸‰ç‚¹å‡»ä»½é¢,${oldDate}-å‰ä¸‰è½¬åŒ–ä»½é¢,${newDate}-å‰ä¸‰è½¬åŒ–ä»½é¢\n`;
            
            analysisResults.forEach(result => {
                csv += `"${result.tags.join(', ')}","${result.keyword}",${result.oldRank},${result.newRank},${result.oldClick},${result.newClick},${result.oldConvert},${result.newConvert}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `åˆ†æç»“æœ_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>
</html>

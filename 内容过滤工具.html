<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡æ–‡æœ¬è¿‡æ»¤å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 30px;
            align-items: start;
        }
        
        .input-section, .output-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .middle-controls {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            min-width: 120px;
        }
        
        .section-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }
        
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: #f1f3f4;
            border-radius: 8px;
        }
        
        .filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .filter-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .filter-group h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .view-words-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-words-btn:hover {
            background: #2980b9;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: #3498db;
        }
        
        .custom-words {
            margin-top: 15px;
        }
        
        .custom-words input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .custom-words-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .processing-options {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            margin: 2px;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2c3e50;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2c3e50;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2c3e50;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
            color: #2c3e50;
        }
        
        .stats {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #27ae60;
        }
        
        .stats h4 {
            color: #27ae60;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #27ae60;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        
        .filtered-words {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }
        
        .filtered-words h5 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .word-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .word-tag {
            background: #ffc107;
            color: #856404;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            color: #333;
        }
        
        .words-display {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .word-item {
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid #bbdefb;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .word-item.editable {
            background: #f3e5f5;
            color: #7b1fa2;
            border-color: #ce93d8;
        }
        
        .word-item.preset {
            background: #e8f5e8;
            color: #2e7d32;
            border-color: #a5d6a7;
        }
        
        .word-item .action-btn {
            background: transparent;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            margin-left: 2px;
        }
        
        .word-item .edit-btn {
            color: #ff9800;
        }
        
        .word-item .edit-btn:hover {
            background: #ff9800;
            color: white;
        }
        
        .word-item .delete-btn {
            color: #f44336;
        }
        
        .word-item .delete-btn:hover {
            background: #f44336;
            color: white;
        }
        
        .word-item .save-btn {
            color: #4caf50;
        }
        
        .word-item .save-btn:hover {
            background: #4caf50;
            color: white;
        }
        
        .word-item .cancel-btn {
            color: #757575;
        }
        
        .word-item .cancel-btn:hover {
            background: #757575;
            color: white;
        }
        
        .word-item input {
            background: transparent;
            border: none;
            color: inherit;
            font-size: inherit;
            font-family: inherit;
            width: 60px;
            outline: none;
            border-bottom: 1px dashed currentColor;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #4caf50, #45a049);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }
        
        .modal-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .middle-controls {
                order: 2;
                flex-direction: row;
                justify-content: center;
                min-width: auto;
            }
            
            .input-section {
                order: 1;
            }
            
            .output-section {
                order: 3;
            }
            
            .filter-options {
                grid-template-columns: 1fr;
            }
            
            .processing-options {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .custom-words-actions {
                flex-direction: column;
            }
        }

        .footer {
            background: #f8f9fa;
            color: #666;
            padding: 15px;
            text-align: center;
            border-top: 1px solid #e9ecef;
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” è‹±æ–‡æ–‡æœ¬è¿‡æ»¤å·¥å…·</h1>
            <p>æ™ºèƒ½ç­›é€‰å’Œåˆ é™¤è‹±æ–‡æ–‡æœ¬ä¸­çš„ä»‹è¯ã€è¿è¯ã€å† è¯ç­‰æ— å®é™…æ„ä¹‰çš„è¯æ±‡  </p>
 <p> ä½œè€…ï¼šé”å“¥</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h3 class="section-title">ğŸ“ æ–‡æœ¬è¾“å…¥</h3>
                <textarea id="inputText" class="textarea" placeholder="è¯·åœ¨æ­¤å¤„è¾“å…¥æˆ–ç²˜è´´æ‚¨çš„è‹±æ–‡æ–‡æœ¬..."></textarea>
                
                <div class="controls">
                    <div class="filter-options">
                        <div class="filter-group">
                            <h4>
                                ğŸ“š é¢„è®¾è¯ç±»
                                <button class="view-words-btn" onclick="showAllPresetWords()">ç®¡ç†è¯åº“</button>
                            </h4>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="articles" checked>
                                    <label for="articles">å† è¯</label>
                                    <button class="btn btn-small view-words-btn" onclick="showWords('articles')">æŸ¥çœ‹</button>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="prepositions" checked>
                                    <label for="prepositions">ä»‹è¯</label>
                                    <button class="btn btn-small view-words-btn" onclick="showWords('prepositions')">æŸ¥çœ‹</button>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="conjunctions" checked>
                                    <label for="conjunctions">è¿è¯</label>
                                    <button class="btn btn-small view-words-btn" onclick="showWords('conjunctions')">æŸ¥çœ‹</button>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="pronouns">
                                    <label for="pronouns">ä»£è¯</label>
                                    <button class="btn btn-small view-words-btn" onclick="showWords('pronouns')">æŸ¥çœ‹</button>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="auxiliaries">
                                    <label for="auxiliaries">åŠ©åŠ¨è¯</label>
                                    <button class="btn btn-small view-words-btn" onclick="showWords('auxiliaries')">æŸ¥çœ‹</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <h4>ğŸ¯ è‡ªå®šä¹‰è¿‡æ»¤è¯</h4>
                            <div class="custom-words">
                                <input type="text" id="customWords" placeholder="è¾“å…¥è‡ªå®šä¹‰è¯æ±‡ï¼Œç”¨é€—å·åˆ†éš”">
                                <div class="custom-words-actions">
                                    <button class="btn btn-small btn-success" onclick="addToPreset()">â• æ·»åŠ åˆ°è¯åº“</button>
                                    <button class="btn btn-small btn-warning" onclick="showCustomWords()">ğŸ“‹ ç®¡ç†è¯åº“</button>
                                    <button class="btn btn-small btn-secondary" onclick="clearCustomWords()">ğŸ—‘ï¸ æ¸…ç©º</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="processing-options">
                        <div class="option-item">
                            <input type="checkbox" id="ignoreCase" checked>
                            <label for="ignoreCase">å¿½ç•¥å¤§å°å†™</label>
                        </div>
                        <div class="option-item">
                            <input type="checkbox" id="removePunctuation">
                            <label for="removePunctuation">åˆ é™¤æ ‡ç‚¹ç¬¦å·</label>
                        </div>
                        <div class="option-item">
                            <input type="checkbox" id="preserveSpacing" checked>
                            <label for="preserveSpacing">ä¿æŒåŸæœ‰é—´è·</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­é—´æ§åˆ¶æŒ‰é’® -->
            <div class="middle-controls">
                <button class="btn" onclick="processText()">ğŸš€ å¼€å§‹è¿‡æ»¤</button>
                <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
            </div>
            
            <div class="output-section">
                <h3 class="section-title">ğŸ“„ è¿‡æ»¤ç»“æœ</h3>
                <textarea id="outputText" class="textarea" readonly placeholder="è¿‡æ»¤åçš„æ–‡æœ¬å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-success" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                    <button class="btn btn-success" onclick="downloadResult()">ğŸ’¾ ä¸‹è½½æ–‡ä»¶</button>
                </div>
                
                <div class="stats" id="statsSection" style="display: none;">
                    <h4>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="originalWords">0</div>
                            <div class="stat-label">åŸå§‹è¯æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="filteredWords">0</div>
                            <div class="stat-label">è¿‡æ»¤åè¯æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="removedWords">0</div>
                            <div class="stat-label">åˆ é™¤è¯æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="removalRate">0%</div>
                            <div class="stat-label">åˆ é™¤ç‡</div>
                        </div>
                    </div>
                    
                    <div class="filtered-words" id="filteredWordsSection" style="display: none;">
                        <h5>ğŸ·ï¸ è¢«è¿‡æ»¤çš„è¯æ±‡</h5>
                        <div class="word-tags" id="wordTags"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">ç‰ˆæƒå½’ è·¨å¢ƒä¹è¶£å›­æ‰€æœ‰ å®˜ç½‘ï¼š <a href="https://amzlink.top/" target="_blank" rel="noopener noreferrer">https://amzlink.top/</a> | ä½œè€…ï¼šé”å“¥</div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div id="wordsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">è¯æ±‡åˆ—è¡¨</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="modalBody">
                <div class="words-display" id="wordsDisplay"></div>
                <div class="modal-actions" id="modalActions" style="display: none;">
                    <button class="btn btn-small btn-success" onclick="addNewWord()">â• æ·»åŠ æ–°è¯</button>
                    <button class="btn btn-small btn-secondary" onclick="resetCategory()">ğŸ”„ æ¢å¤é»˜è®¤</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>
    
    <script>
        // é¢„è®¾è¯æ±‡åˆ—è¡¨ï¼ˆåŸå§‹å¤‡ä»½ï¼‰
        const originalWordLists = {
            articles: ['a', 'an', 'the'],
            prepositions: ['in', 'on', 'at', 'by', 'for', 'with', 'to', 'of', 'from', 'up', 'about', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'between', 'among', 'under', 'over', 'beside', 'behind', 'across', 'against', 'within', 'without', 'upon', 'beneath', 'beyond', 'throughout', 'underneath'],
            conjunctions: ['and', 'or', 'but', 'nor', 'for', 'so', 'yet', 'because', 'since', 'as', 'if', 'unless', 'while', 'when', 'where', 'although', 'though', 'whereas', 'however', 'therefore', 'moreover', 'furthermore', 'nevertheless', 'nonetheless'],
            pronouns: ['i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us', 'them', 'my', 'your', 'his', 'her', 'its', 'our', 'their', 'mine', 'yours', 'hers', 'ours', 'theirs', 'this', 'that', 'these', 'those', 'who', 'whom', 'whose', 'which', 'what'],
            auxiliaries: ['am', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'shall', 'should', 'may', 'might', 'can', 'could', 'must', 'ought']
        };
        
        // å½“å‰ä½¿ç”¨çš„è¯æ±‡åˆ—è¡¨ï¼ˆå¯ç¼–è¾‘ï¼‰
        let wordLists = JSON.parse(JSON.stringify(originalWordLists));
        
        // è¯ç±»åç§°æ˜ å°„
        const categoryNames = {
            articles: 'å† è¯',
            prepositions: 'ä»‹è¯',
            conjunctions: 'è¿è¯',
            pronouns: 'ä»£è¯',
            auxiliaries: 'åŠ©åŠ¨è¯'
        };
        
        // è‡ªå®šä¹‰è¯åº“
        let customWordBank = [];
        
        // å½“å‰ç¼–è¾‘çŠ¶æ€
        let currentEditingCategory = null;
        
        // æ˜¾ç¤ºç‰¹å®šç±»åˆ«çš„è¯æ±‡
        function showWords(category) {
            currentEditingCategory = category;
            const words = wordLists[category];
            const categoryName = categoryNames[category];
            
            document.getElementById('modalTitle').textContent = `${categoryName} (${words.length}ä¸ª)`;
            
            const wordsDisplay = document.getElementById('wordsDisplay');
            wordsDisplay.innerHTML = '';
            
            // æ·»åŠ è¯´æ˜
            const instruction = document.createElement('p');
            instruction.textContent = 'ç‚¹å‡» âœï¸ ç¼–è¾‘è¯æ±‡ï¼Œç‚¹å‡» Ã— åˆ é™¤è¯æ±‡';
            instruction.style.marginBottom = '15px';
            instruction.style.color = '#666';
            instruction.style.fontStyle = 'italic';
            wordsDisplay.appendChild(instruction);
            
            words.forEach((word, index) => {
                const wordElement = createWordElement(word, index, 'preset', category);
                wordsDisplay.appendChild(wordElement);
            });
            
            // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
            document.getElementById('modalActions').style.display = 'flex';
            document.getElementById('wordsModal').style.display = 'block';
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰é¢„è®¾è¯æ±‡
        function showAllPresetWords() {
            currentEditingCategory = null;
            document.getElementById('modalTitle').textContent = 'é¢„è®¾è¯åº“ç®¡ç†';
            
            const wordsDisplay = document.getElementById('wordsDisplay');
            wordsDisplay.innerHTML = '';
            
            // æ·»åŠ è¯´æ˜
            const instruction = document.createElement('p');
            instruction.textContent = 'ç®¡ç†æ‰€æœ‰é¢„è®¾è¯åº“ï¼Œå¯ä»¥æ·»åŠ ã€ç¼–è¾‘æˆ–åˆ é™¤è¯æ±‡';
            instruction.style.marginBottom = '20px';
            instruction.style.color = '#666';
            instruction.style.fontStyle = 'italic';
            wordsDisplay.appendChild(instruction);
            
            Object.entries(wordLists).forEach(([category, words]) => {
                const categoryTitle = document.createElement('h4');
                categoryTitle.textContent = `${categoryNames[category]} (${words.length}ä¸ª)`;
                categoryTitle.style.width = '100%';
                categoryTitle.style.margin = '15px 0 10px 0';
                categoryTitle.style.color = '#2c3e50';
                categoryTitle.style.borderBottom = '1px solid #ddd';
                categoryTitle.style.paddingBottom = '5px';
                categoryTitle.style.display = 'flex';
                categoryTitle.style.justifyContent = 'space-between';
                categoryTitle.style.alignItems = 'center';
                
                const manageBtn = document.createElement('button');
                manageBtn.className = 'btn btn-small view-words-btn';
                manageBtn.textContent = 'ç®¡ç†';
                manageBtn.onclick = () => showWords(category);
                categoryTitle.appendChild(manageBtn);
                
                wordsDisplay.appendChild(categoryTitle);
                
                words.forEach((word, index) => {
                    const wordElement = createWordElement(word, index, 'preset', category);
                    wordsDisplay.appendChild(wordElement);
                });
            });
            
            // éšè—æ“ä½œæŒ‰é’®
            document.getElementById('modalActions').style.display = 'none';
            document.getElementById('wordsModal').style.display = 'block';
        }
        
        // æ˜¾ç¤ºå’Œç®¡ç†è‡ªå®šä¹‰è¯æ±‡
        function showCustomWords() {
            currentEditingCategory = 'custom';
            if (customWordBank.length === 0) {
                showNotification('æš‚æ— è‡ªå®šä¹‰è¯æ±‡', 'warning');
                return;
            }
            
            document.getElementById('modalTitle').textContent = `è‡ªå®šä¹‰è¯åº“ç®¡ç† (${customWordBank.length}ä¸ª)`;
            
            const wordsDisplay = document.getElementById('wordsDisplay');
            wordsDisplay.innerHTML = '';
            
            // æ·»åŠ è¯´æ˜
const instruction = document.createElement('p');
instruction.textContent = 'ç‚¹å‡» âœï¸ ç¼–è¾‘è¯æ±‡ï¼Œç‚¹å‡» Ã— åˆ é™¤è¯æ±‡';
instruction.style.marginBottom = '15px';
instruction.style.color = '#666';
instruction.style.fontStyle = 'italic';
wordsDisplay.appendChild(instruction);

customWordBank.forEach((word, index) => {
    const wordElement = createWordElement(word, index, 'custom', 'custom');
    wordsDisplay.appendChild(wordElement);
});

// éšè—æ“ä½œæŒ‰é’®
document.getElementById('modalActions').style.display = 'none';
document.getElementById('wordsModal').style.display = 'block';
}

// åˆ›å»ºè¯æ±‡å…ƒç´ 
function createWordElement(word, index, type, category) {
    const wordElement = document.createElement('span');
    wordElement.className = `word-item ${type}`;
    wordElement.setAttribute('data-index', index);
    wordElement.setAttribute('data-category', category);
    
    const wordText = document.createElement('span');
    wordText.className = 'word-text';
    wordText.textContent = word;
    
    const editBtn = document.createElement('button');
    editBtn.className = 'action-btn edit-btn';
    editBtn.innerHTML = 'âœï¸';
    editBtn.title = 'ç¼–è¾‘';
    editBtn.onclick = (e) => {
        e.stopPropagation();
        startEditing(wordElement, word, index, category);
    };
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'action-btn delete-btn';
    deleteBtn.innerHTML = 'Ã—';
    deleteBtn.title = 'åˆ é™¤';
    deleteBtn.onclick = (e) => {
        e.stopPropagation();
        deleteWord(word, index, category);
    };
    
    wordElement.appendChild(wordText);
    wordElement.appendChild(editBtn);
    wordElement.appendChild(deleteBtn);
    
    return wordElement;
}

// å¼€å§‹ç¼–è¾‘è¯æ±‡
function startEditing(wordElement, originalWord, index, category) {
    const wordText = wordElement.querySelector('.word-text');
    const editBtn = wordElement.querySelector('.edit-btn');
    const deleteBtn = wordElement.querySelector('.delete-btn');
    
    // åˆ›å»ºè¾“å…¥æ¡†
    const input = document.createElement('input');
    input.type = 'text';
    input.value = originalWord;
    input.style.width = Math.max(60, originalWord.length * 8) + 'px';
    
    // åˆ›å»ºä¿å­˜å’Œå–æ¶ˆæŒ‰é’®
    const saveBtn = document.createElement('button');
    saveBtn.className = 'action-btn save-btn';
    saveBtn.innerHTML = 'âœ“';
    saveBtn.title = 'ä¿å­˜';
    
    const cancelBtn = document.createElement('button');
    cancelBtn.className = 'action-btn cancel-btn';
    cancelBtn.innerHTML = 'âœ•';
    cancelBtn.title = 'å–æ¶ˆ';
    
    // æ›¿æ¢å†…å®¹
    wordElement.innerHTML = '';
    wordElement.appendChild(input);
    wordElement.appendChild(saveBtn);
    wordElement.appendChild(cancelBtn);
    
    // èšç„¦è¾“å…¥æ¡†
    input.focus();
    input.select();
    
    // ä¿å­˜åŠŸèƒ½
    const saveEdit = () => {
        const newWord = input.value.trim().toLowerCase();
        if (newWord === '') {
            showNotification('è¯æ±‡ä¸èƒ½ä¸ºç©ºï¼', 'warning');
            return;
        }
        
        if (newWord === originalWord) {
            cancelEdit();
            return;
        }
        
        // æ£€æŸ¥æ˜¯å¦é‡å¤
        if (isWordDuplicate(newWord, category, index)) {
            showNotification('è¯¥è¯æ±‡å·²å­˜åœ¨ï¼', 'warning');
            return;
        }
        
        // æ›´æ–°è¯æ±‡
        if (category === 'custom') {
            customWordBank[index] = newWord;
        } else {
            wordLists[category][index] = newWord;
        }
        
        showNotification(`è¯æ±‡å·²æ›´æ–°: "${originalWord}" â†’ "${newWord}"`, 'success');
        
        // åˆ·æ–°æ˜¾ç¤º
        if (category === 'custom') {
            showCustomWords();
        } else {
            showWords(category);
        }
    };
    
    // å–æ¶ˆç¼–è¾‘
    const cancelEdit = () => {
        // æ¢å¤åŸå§‹å†…å®¹
        wordElement.innerHTML = '';
        const wordText = document.createElement('span');
        wordText.className = 'word-text';
        wordText.textContent = originalWord;
        
        const editBtn = document.createElement('button');
        editBtn.className = 'action-btn edit-btn';
        editBtn.innerHTML = 'âœï¸';
        editBtn.title = 'ç¼–è¾‘';
        editBtn.onclick = (e) => {
            e.stopPropagation();
            startEditing(wordElement, originalWord, index, category);
        };
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'action-btn delete-btn';
        deleteBtn.innerHTML = 'Ã—';
        deleteBtn.title = 'åˆ é™¤';
        deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteWord(originalWord, index, category);
        };
        
        wordElement.appendChild(wordText);
        wordElement.appendChild(editBtn);
        wordElement.appendChild(deleteBtn);
    };
    
    // ç»‘å®šäº‹ä»¶
    saveBtn.onclick = saveEdit;
    cancelBtn.onclick = cancelEdit;
    
    // å›è½¦ä¿å­˜ï¼ŒESCå–æ¶ˆ
    input.onkeydown = (e) => {
        if (e.key === 'Enter') {
            saveEdit();
        } else if (e.key === 'Escape') {
            cancelEdit();
        }
    };
}

// åˆ é™¤è¯æ±‡
function deleteWord(word, index, category) {
    if (!confirm(`ç¡®å®šè¦åˆ é™¤è¯æ±‡ "${word}" å—ï¼Ÿ`)) {
        return;
    }
    
    if (category === 'custom') {
        customWordBank.splice(index, 1);
        showNotification(`å·²åˆ é™¤è¯æ±‡ "${word}"`, 'success');
        if (customWordBank.length === 0) {
            closeModal();
        } else {
            showCustomWords();
        }
    } else {
        wordLists[category].splice(index, 1);
        showNotification(`å·²åˆ é™¤è¯æ±‡ "${word}"`, 'success');
        showWords(category);
    }
}

// æ£€æŸ¥è¯æ±‡æ˜¯å¦é‡å¤
function isWordDuplicate(word, category, currentIndex) {
    // æ£€æŸ¥å½“å‰ç±»åˆ«
    if (category === 'custom') {
        return customWordBank.some((w, i) => w === word && i !== currentIndex);
    } else {
        if (wordLists[category].some((w, i) => w === word && i !== currentIndex)) {
            return true;
        }
    }
    
    // æ£€æŸ¥å…¶ä»–é¢„è®¾ç±»åˆ«
    if (category !== 'custom') {
        for (let cat in wordLists) {
            if (cat !== category && wordLists[cat].includes(word)) {
                return true;
            }
        }
    }
    
    // æ£€æŸ¥è‡ªå®šä¹‰è¯åº“
    if (category !== 'custom' && customWordBank.includes(word)) {
        return true;
    }
    
    return false;
}

// æ·»åŠ æ–°è¯æ±‡åˆ°å½“å‰ç±»åˆ«
function addNewWord() {
    if (!currentEditingCategory || currentEditingCategory === 'custom') {
        showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¢„è®¾è¯ç±»è¿›è¡Œç®¡ç†', 'warning');
        return;
    }
    
    const newWord = prompt('è¯·è¾“å…¥æ–°è¯æ±‡:');
    if (!newWord || !newWord.trim()) {
        return;
    }
    
    const word = newWord.trim().toLowerCase();
    
    // æ£€æŸ¥é‡å¤
    if (isWordDuplicate(word, currentEditingCategory, -1)) {
        showNotification('è¯¥è¯æ±‡å·²å­˜åœ¨ï¼', 'warning');
        return;
    }
    
    // æ·»åŠ è¯æ±‡
    wordLists[currentEditingCategory].push(word);
    showNotification(`å·²æ·»åŠ è¯æ±‡ "${word}" åˆ° ${categoryNames[currentEditingCategory]}`, 'success');
    
    // åˆ·æ–°æ˜¾ç¤º
    showWords(currentEditingCategory);
}

// æ¢å¤ç±»åˆ«é»˜è®¤è¯æ±‡
function resetCategory() {
    if (!currentEditingCategory || currentEditingCategory === 'custom') {
        showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¢„è®¾è¯ç±»è¿›è¡Œç®¡ç†', 'warning');
        return;
    }
    
    const categoryName = categoryNames[currentEditingCategory];
    if (!confirm(`ç¡®å®šè¦æ¢å¤ ${categoryName} çš„é»˜è®¤è¯æ±‡å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰æ·»åŠ çš„è¯æ±‡ã€‚`)) {
        return;
    }
    
    // æ¢å¤é»˜è®¤
    wordLists[currentEditingCategory] = [...originalWordLists[currentEditingCategory]];
    showNotification(`${categoryName} å·²æ¢å¤é»˜è®¤è¯æ±‡`, 'success');
    
    // åˆ·æ–°æ˜¾ç¤º
    showWords(currentEditingCategory);
}

// æ·»åŠ åˆ°é¢„è®¾è¯åº“
function addToPreset() {
    const customWords = document.getElementById('customWords').value
        .split(',')
        .map(word => word.trim().toLowerCase())
        .filter(word => word.length > 0);
    
    if (customWords.length === 0) {
        showNotification('è¯·è¾“å…¥è¦æ·»åŠ çš„è¯æ±‡', 'warning');
        return;
    }
    
    let addedCount = 0;
    let existingWords = [];
    
    customWords.forEach(word => {
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨äºé¢„è®¾è¯åº“ä¸­
        let exists = false;
        for (let category in wordLists) {
            if (wordLists[category].includes(word)) {
                exists = true;
                break;
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨äºè‡ªå®šä¹‰è¯åº“ä¸­
        if (!exists && customWordBank.includes(word)) {
            exists = true;
        }
        
        if (exists) {
            existingWords.push(word);
        } else {
            customWordBank.push(word);
            addedCount++;
        }
    });
    
    if (addedCount > 0) {
        showNotification(`æˆåŠŸæ·»åŠ  ${addedCount} ä¸ªè¯æ±‡åˆ°è‡ªå®šä¹‰è¯åº“`, 'success');
    }
    
    if (existingWords.length > 0) {
        showNotification(`${existingWords.join(', ')} å·²å­˜åœ¨äºè¯åº“ä¸­`, 'warning');
    }
    
    // æ¸…ç©ºè¾“å…¥æ¡†
    document.getElementById('customWords').value = '';
}

// æ¸…ç©ºè‡ªå®šä¹‰è¯æ±‡
function clearCustomWords() {
    if (customWordBank.length === 0) {
        showNotification('è‡ªå®šä¹‰è¯åº“å·²ä¸ºç©º', 'warning');
        return;
    }
    
    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰è¯æ±‡å—ï¼Ÿ')) {
        customWordBank = [];
        showNotification('è‡ªå®šä¹‰è¯åº“å·²æ¸…ç©º', 'success');
    }
}

// å…³é—­æ¨¡æ€æ¡†
function closeModal() {
    document.getElementById('wordsModal').style.display = 'none';
    currentEditingCategory = null;
}

// æ˜¾ç¤ºé€šçŸ¥
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    
    // æ˜¾ç¤ºé€šçŸ¥
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // 3ç§’åéšè—
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3100);
}

// å¤„ç†æ–‡æœ¬
function processText() {
    const inputText = document.getElementById('inputText').value.trim();
    
    if (!inputText) {
        showNotification('è¯·è¾“å…¥è¦å¤„ç†çš„æ–‡æœ¬ï¼', 'warning');
        return;
    }
    
    // è·å–é€‰ä¸­çš„è¿‡æ»¤é€‰é¡¹
    const filterOptions = {
        articles: document.getElementById('articles').checked,
        prepositions: document.getElementById('prepositions').checked,
        conjunctions: document.getElementById('conjunctions').checked,
        pronouns: document.getElementById('pronouns').checked,
        auxiliaries: document.getElementById('auxiliaries').checked
    };
    
    // è·å–å¤„ç†é€‰é¡¹
    const ignoreCase = document.getElementById('ignoreCase').checked;
    const removePunctuation = document.getElementById('removePunctuation').checked;
    const preserveSpacing = document.getElementById('preserveSpacing').checked;
    
    // æ„å»ºè¦è¿‡æ»¤çš„è¯æ±‡åˆ—è¡¨
    let wordsToFilter = [];
    
    // æ·»åŠ é€‰ä¸­çš„é¢„è®¾è¯ç±»
    Object.entries(filterOptions).forEach(([category, isSelected]) => {
        if (isSelected) {
            wordsToFilter = wordsToFilter.concat(wordLists[category]);
        }
    });
    
    // æ·»åŠ è‡ªå®šä¹‰è¯æ±‡
    wordsToFilter = wordsToFilter.concat(customWordBank);
    
    // æ·»åŠ è¾“å…¥æ¡†ä¸­çš„ä¸´æ—¶è¯æ±‡
    const tempCustomWords = document.getElementById('customWords').value
        .split(',')
        .map(word => word.trim().toLowerCase())
        .filter(word => word.length > 0);
    wordsToFilter = wordsToFilter.concat(tempCustomWords);
    
    // å»é‡
    wordsToFilter = [...new Set(wordsToFilter)];
    
    if (wordsToFilter.length === 0) {
        showNotification('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§è¿‡æ»¤ç±»å‹æˆ–è¾“å…¥è‡ªå®šä¹‰è¯æ±‡ï¼', 'warning');
        return;
    }
    
    // å¼€å§‹å¤„ç†æ–‡æœ¬
    let processedText = inputText;
    const originalWords = inputText.split(/\s+/).filter(word => word.length > 0);
    const removedWords = [];
    const wordFrequency = {};
    
    // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè¯æ±‡è¿‡æ»¤
    wordsToFilter.forEach(word => {
        const flags = ignoreCase ? 'gi' : 'g';
        const regex = new RegExp(`\\b${word}\\b`, flags);
        
        // ç»Ÿè®¡è¢«åˆ é™¤çš„è¯æ±‡
        const matches = processedText.match(regex);
        if (matches) {
            const lowerWord = word.toLowerCase();
            wordFrequency[lowerWord] = (wordFrequency[lowerWord] || 0) + matches.length;
            removedWords.push(...matches);
        }
        
        // åˆ é™¤è¯æ±‡
        if (preserveSpacing) {
            processedText = processedText.replace(regex, '');
        } else {
            processedText = processedText.replace(regex, ' ');
        }
    });
    
    // æ¸…ç†å¤šä½™çš„ç©ºæ ¼
    processedText = processedText.replace(/\s+/g, ' ').trim();
    
    // åˆ é™¤æ ‡ç‚¹ç¬¦å·ï¼ˆå¦‚æœé€‰ä¸­ï¼‰
    if (removePunctuation) {
        processedText = processedText.replace(/[^\w\s]/g, '');
    }
    
    // æ˜¾ç¤ºç»“æœ
    document.getElementById('outputText').value = processedText;
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStats(originalWords, processedText, removedWords, wordFrequency);
    
    // æ˜¾ç¤ºå¤„ç†å®Œæˆé€šçŸ¥
    showNotification('æ–‡æœ¬è¿‡æ»¤å®Œæˆï¼', 'success');
}

function updateStats(originalWords, processedText, removedWords, wordFrequency) {
    const filteredWords = processedText.split(/\s+/).filter(word => word.length > 0);
    const removedCount = removedWords.length;
    const removalRate = originalWords.length > 0 ? Math.round((removedCount / originalWords.length) * 100) : 0;
    
    document.getElementById('originalWords').textContent = originalWords.length;
    document.getElementById('filteredWords').textContent = filteredWords.length;
    document.getElementById('removedWords').textContent = removedCount;
    document.getElementById('removalRate').textContent = removalRate + '%';
    
    // æ˜¾ç¤ºè¢«è¿‡æ»¤çš„è¯æ±‡
    const wordTags = document.getElementById('wordTags');
    wordTags.innerHTML = '';
    
    Object.entries(wordFrequency).forEach(([word, count]) => {
        const tag = document.createElement('span');
        tag.className = 'word-tag';
        tag.textContent = `${word} (${count})`;
        wordTags.appendChild(tag);
    });
    
    // æ˜¾ç¤ºç»Ÿè®¡åŒºåŸŸ
    document.getElementById('statsSection').style.display = 'block';
    if (Object.keys(wordFrequency).length > 0) {
        document.getElementById('filteredWordsSection').style.display = 'block';
    }
}

function copyResult() {
    const outputText = document.getElementById('outputText');
    if (!outputText.value.trim()) {
        showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼', 'warning');
        return;
    }
    outputText.select();
    document.execCommand('copy');
    showNotification('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
}

function downloadResult() {
    const outputText = document.getElementById('outputText').value;
    if (!outputText.trim()) {
        showNotification('æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹ï¼', 'warning');
        return;
    }
    
    const blob = new Blob([outputText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'filtered_text.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification('æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', 'success');
}

function clearAll() {
    document.getElementById('inputText').value = '';
    document.getElementById('outputText').value = '';
    document.getElementById('customWords').value = '';
    document.getElementById('statsSection').style.display = 'none';
    document.getElementById('filteredWordsSection').style.display = 'none';
    showNotification('æ‰€æœ‰å†…å®¹å·²æ¸…ç©ºï¼', 'success');
}

// ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
window.onclick = function(event) {
    const modal = document.getElementById('wordsModal');
    if (event.target === modal) {
        closeModal();
    }
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>äºšé©¬é€Šç¾å›½ç«™é…é€è´¹ç”¨è®¡ç®—å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f6f7f9; }
    h2 { color: #2a5d9f; margin-bottom: 5px;}
    .author { font-size: 15px; color: #444; margin-bottom: 15px;}
    label { display: block; margin-top: 10px; }
    .row { margin-bottom: 10px; }
    .result { background: #fff; border: 1px solid #ddd; padding: 15px; margin-top: 20px; border-radius: 8px;}
    select, input[type="number"] { width: 80px; }
    .unit { margin-left: 5px; }
    .desc { color: #666; font-size: 13px; margin-bottom: 10px;}
    .footer { margin-top: 40px; font-size: 13px; color: #888; text-align: center;}
    table { border-collapse:collapse;width:100%;background:#fff;margin:10px 0 15px 0;}
    th, td { border:1px solid #ddd;padding:4px;}
    th { background:#e6ecfa;}
    .tab-btns {margin-bottom:10px;}
    .tab-btns button {margin-right:6px;padding:3px 12px;border-radius:5px;border:1px solid #2a5d9f;background:#f6f7f9;color:#2a5d9f;cursor:pointer;}
    .tab-btns button.active {background:#2a5d9f;color:#fff;}
    .download-btn {background:#28a745!important;color:#fff!important;border-color:#28a745!important;}
    .download-btn:hover {background:#218838!important;}
    .fee-table {display:none;}
    .fee-table.active {display:block;}
  </style>
</head>
<body>
  <h2>äºšé©¬é€Šç¾å›½ç«™é…é€è´¹ç”¨è®¡ç®—å·¥å…·</h2>
  <div class="author">ä½œè€…ï¼šé”å“¥</div>
  <div class="desc">è¾“å…¥å•†å“å°ºå¯¸ã€é‡é‡ä¸å”®ä»·ï¼Œé€‰æ‹©å•ä½ä¸å­£èŠ‚ï¼Œç‚¹å‡»è®¡ç®—ã€‚</div>
  <div>
    <div class="row">
      <label>é•¿åº¦:
        <input id="length" type="number" min="0" step="0.01" value="0">
        <select id="lengthUnit">
          <option value="in">inches</option>
          <option value="cm">cm</option>
        </select>
      </label>
      <label>å®½åº¦:
        <input id="width" type="number" min="0" step="0.01" value="0">
        <select id="widthUnit">
          <option value="in">inches</option>
          <option value="cm">cm</option>
        </select>
      </label>
      <label>é«˜åº¦:
        <input id="height" type="number" min="0" step="0.01" value="0">
        <select id="heightUnit">
          <option value="in">inches</option>
          <option value="cm">cm</option>
        </select>
      </label>
    </div>
    <div class="row">
      <label>å®é™…é‡é‡:
        <input id="actualWeight" type="number" min="0" step="0.01" value="0">
        <select id="weightUnit">
          <option value="oz">oz</option>
          <option value="g">g</option>
          <option value="lb">lb</option>
        </select>
      </label>
    </div>
    <div class="row">
      <label>å•†å“ç±»å‹:
        <select id="productType" onchange="showFeeTab()">
          <option value="normal">æ™®é€šï¼ˆéæœè£…/éå±é™©å“ï¼‰</option>
          <option value="apparel">æœè£…</option>
          <option value="danger">å±é™©å“</option>
        </select>
      </label>
    </div>
    <div class="row">
      <label>å”®ä»·(USD):
        <input id="priceUSD" type="number" min="0" step="0.01" value="0" style="width:120px;">
      </label>
      <label class="unit" style="margin-left:12px;">å­£èŠ‚:
        <select id="season" onchange="showFeeTab()">
          <option value="non_peak">éæ—ºå­£</option>
          <option value="peak">æ—ºå­£</option>
        </select>
      </label>
      <label class="unit" style="margin-left:12px;">è®¡è´¹ç‰ˆæœ¬:
        <select id="version" onchange="showFeeTab()">
          <option value="2025">2025</option>
          <option value="2026">2026</option>
        </select>
        <span style="margin-left:6px;color:#666;font-size:12px;">éæ—ºå­£ç‰ˆæœ¬ï¼š2025(è‡³2025-10-14)ã€2026(è‡ª2026-01-15)</span>
      </label>
      <label class="unit" style="margin-left:12px;">è‡ªåŠ¨æŒ‰æ—¥æœŸ:
        <input id="autoSeason" type="checkbox" checked onchange="onAutoSeasonToggle()">
      </label>
    </div>
    <div class="row">
      <label>é™„åŠ è´¹(USD):
        <input id="surchargeUSD" type="number" min="0" step="0.01" value="0" style="width:120px;">
        <span style="margin-left:6px;color:#666;font-size:12px;">é€šå¸¸æ— éœ€å¡«å†™ï¼›ç‰¹å¤§å·å¯èƒ½äº§ç”Ÿå®˜æ–¹é™„åŠ è´¹å¯åœ¨æ­¤å½•å…¥</span>
      </label>
      <label class="unit" style="margin-left:12px;">å«é”‚ç”µæ± :
        <input id="hasLithium" type="checkbox">
        <span style="margin-left:6px;color:#666;font-size:12px;">éå±é™©å“å‹¾é€‰è‡ªåŠ¨åŠ æ”¶ $0.11</span>
      </label>
    </div>
    <button onclick="calculate()">è®¡ç®—</button>
    <button onclick="resetInputs()" style="margin-left:10px;">é‡ç½®</button>
  </div>
  <div class="desc" style="background:#fff;border:1px solid #ddd;padding:10px;border-radius:6px;">
    æ€»è¯´æ˜ï¼š
    <br>â€¢ æ—ºå­£(2025-10-15~2026-01-14)ä¸éæ—ºå­£è´¹ç‡ä¸åŒï¼›éæ—ºå­£æŒ‰å¹´ä»½ç‰ˆæœ¬è®¡è´¹
    <br>â€¢ å”®ä»·æ¡£ä½å½±å“è´¹ç‡ï¼š<$10ã€$10~$50ã€>$50
    <br>â€¢ éå±é™©å“å«é”‚ç”µæ± åŠ æ”¶ $0.11ï¼›å±é™©å“ä¸é€‚ç”¨è¯¥é™„åŠ 
    <br>â€¢ è‹¥æ£€æµ‹åˆ°ç‰¹å¤§å·æ¡ä»¶ï¼ˆæœ€é•¿è¾¹>96è‹±å¯¸æˆ–é•¿åº¦+å›´é•¿>130è‹±å¯¸ï¼Œä¸”â‰¤150ç£…ï¼‰å¯èƒ½äº§ç”Ÿå®˜æ–¹é™„åŠ è´¹
  </div>
  <div class="result" id="result" style="display:none"></div>

  <!-- è§„åˆ™ä¸è¯´æ˜åŒºå—å¼€å§‹ -->
  <h2>äºšé©¬é€Šç¾å›½ç«™é…é€è´¹ç”¨ä¸å°ºå¯¸åˆ†æ®µè§„åˆ™ï¼ˆä¾æ®æ–°è§„åˆ™ï¼‰</h2>
  <div class="desc">
    <b>1. å•†å“å°ºå¯¸åˆ†æ®µå®šä¹‰</b>
    <table>
      <tr>
        <th>å•†å“å°ºå¯¸åˆ†æ®µ</th>
        <th>å‘è´§é‡é‡</th>
        <th>æœ€é•¿è¾¹</th>
        <th>æ¬¡é•¿è¾¹</th>
        <th>æœ€çŸ­è¾¹</th>
        <th>é•¿åº¦+å›´é•¿</th>
      </tr>
      <tr>
        <td>å°å·æ ‡å‡†å°ºå¯¸</td>
        <td>â‰¤16ç›å¸</td>
        <td>â‰¤15è‹±å¯¸</td>
        <td>â‰¤12è‹±å¯¸</td>
        <td>â‰¤0.75è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
      </tr>
      <tr>
        <td>å¤§å·æ ‡å‡†å°ºå¯¸</td>
        <td>â‰¤20ç£…</td>
        <td>â‰¤18è‹±å¯¸</td>
        <td>â‰¤14è‹±å¯¸</td>
        <td>â‰¤8è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
      </tr>
      <tr>
        <td>å°å·å¤§ä»¶</td>
        <td>â‰¤70ç£…</td>
        <td>â‰¤60è‹±å¯¸</td>
        <td>â‰¤30è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
        <td>â‰¤130è‹±å¯¸</td>
      </tr>
      <tr>
        <td>ä¸­å·å¤§ä»¶</td>
        <td>â‰¤150ç£…</td>
        <td>â‰¤108è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
        <td>ä¸é€‚ç”¨</td>
        <td>â‰¤130è‹±å¯¸</td>
      </tr>
      <tr>
        <td>å¤§å·å¤§ä»¶</td>
        <td>â‰¤150ç£…</td>
        <td>â‰¤108è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
        <td>ä¸é€‚ç”¨</td>
        <td>â‰¤165è‹±å¯¸</td>
      </tr>
      <tr>
        <td>ç‰¹æ®Šå¤§ä»¶</td>
        <td>è¶…è¿‡150ç£…</td>
        <td>è¶…è¿‡108è‹±å¯¸</td>
        <td>ä¸é€‚ç”¨</td>
        <td>ä¸é€‚ç”¨</td>
        <td>è¶…è¿‡165è‹±å¯¸</td>
      </tr>
    </table>
    <ul style="margin-left:18px;">
      <li>å‘è´§é‡é‡ä¸ºå•†å“é‡é‡æˆ–ä½“ç§¯é‡é‡ä¸­çš„è¾ƒå¤§å€¼ï¼Œç”¨äºç¡®å®šå°ºå¯¸åˆ†æ®µã€‚</li>
      <li>å¯¹äºå¤§å·æ ‡å‡†å°ºå¯¸ã€å¤§å·å¤§ä»¶å’Œè¶…å¤§ä»¶ï¼ˆ150ç£…ä»¥ä¸‹ï¼‰ï¼Œäºšé©¬é€Šä½¿ç”¨ä½“ç§¯é‡é‡è®¡è´¹ï¼ˆå¦‚æœä½“ç§¯é‡é‡&gt;å•†å“é‡é‡ï¼‰ã€‚</li>
      <li>å¯¹äºå°å·æ ‡å‡†å°ºå¯¸ã€è¶…å¤§ä»¶ï¼ˆ150ç£…åŠä»¥ä¸Šï¼‰ï¼Œä»…ä½¿ç”¨å•†å“é‡é‡è®¡è´¹ã€‚</li>
      <li>ä½“ç§¯é‡é‡è®¡ç®—å…¬å¼ï¼š<b>ä½“ç§¯é‡é‡(ç£…) = (é•¿xå®½xé«˜ï¼Œå•ä½è‹±å¯¸) Ã· 139</b>ï¼Œå®½å’Œé«˜æœ€å°å–2è‹±å¯¸ã€‚</li>
    </ul>

    <b>2. é…é€è´¹ç”¨åˆ†æ®µ</b>
    <div class="tab-btns">
      <button type="button" class="active" onclick="switchTab('normal')">æ™®é€šå•†å“</button>
      <button type="button" onclick="switchTab('apparel')">æœè£…</button>
      <button type="button" onclick="switchTab('danger')">å±é™©å“</button>
      <button type="button" onclick="downloadCurrentTable()" style="background:#28a745;color:#fff;border-color:#28a745;margin-left:10px;">ğŸ“¥ ä¸‹è½½å½“å‰è¡¨æ ¼</button>
    </div>
    <div class="row" style="margin:6px 0 8px 0;">
      <label style="display:inline-block;margin-right:12px;">å­£èŠ‚:
        <select id="tableSeason" onchange="onTableSeasonChange(this)">
          <option value="non_peak">éæ—ºå­£</option>
          <option value="peak">æ—ºå­£</option>
        </select>
      </label>
      <label class="unit" style="display:inline-block;margin-right:12px;">è®¡è´¹ç‰ˆæœ¬:
        <select id="tableVersion" onchange="onTableVersionChange(this)">
          <option value="2025">2025</option>
          <option value="2026">2026</option>
        </select>
      </label>
      <label class="unit" style="display:inline-block;">è‡ªåŠ¨æŒ‰æ—¥æœŸ:
        <input id="tableAutoSeason" type="checkbox" checked onchange="onTableAutoSeasonToggle()">
      </label>
    </div>
    <div id="fee-normal" class="fee-table active"></div>
    <div id="fee-apparel" class="fee-table"></div>
    <div id="fee-danger" class="fee-table"></div>
    <ul style="margin-left:18px;">
      <li>æœè£…ç±»å•†å“ã€å±é™©å“å•†å“é…é€è´¹ç”¨ä¸æ™®é€šå•†å“æœ‰æ‰€ä¸åŒï¼Œå…·ä½“è§ä¸Šè¡¨ã€‚</li>
      <li>æ‰€æœ‰è´¹ç”¨æŒ‰å‘è´§é‡é‡è®¡è´¹ï¼Œå‘è´§é‡é‡ä¸ºå®é™…é‡é‡å’Œä½“ç§¯é‡é‡ä¸­çš„è¾ƒå¤§å€¼ã€‚</li>
    </ul>
    <b>3. å¸¸è§é—®é¢˜ï¼š</b>
    <ul style="margin-left:18px;">
      <li><b>å•†å“é‡é‡</b>ï¼šæŒ‡å•†å“å®Œå…¨åŒ…è£…åçš„å®é™…ç§°é‡é‡é‡ã€‚</li>
      <li><b>ä½“ç§¯é‡é‡</b>ï¼šæ ¹æ®å•†å“å°ºå¯¸ä¼°ç®—çš„é‡é‡ï¼Œé€‚ç”¨å¤§å·æ ‡å‡†å°ºå¯¸ã€å¤§å·å¤§ä»¶ã€è¶…å¤§ä»¶ï¼ˆ150ç£…ä»¥ä¸‹ï¼‰ã€‚</li>
      <li>å‘è´§é‡é‡å–å•†å“é‡é‡ä¸ä½“ç§¯é‡é‡ä¸­çš„è¾ƒå¤§å€¼ï¼Œç¡®å®šæœ€ç»ˆè´¹ç”¨åˆ†æ®µã€‚</li>
    </ul>
    <b>4. ç¤ºä¾‹ï¼š</b>
    <ul style="margin-left:18px;">
      <li>ç§»åŠ¨è®¾å¤‡å£³ï¼š13.8Ã—9Ã—0.7è‹±å¯¸ï¼Œ2.88ç›å¸ï¼Œåˆ†æ®µï¼šå°å·æ ‡å‡†å°ºå¯¸</li>
      <li>Tæ¤ï¼š8.5Ã—4.8Ã—1è‹±å¯¸ï¼Œ6.08ç›å¸ï¼Œåˆ†æ®µï¼šå¤§å·æ ‡å‡†å°ºå¯¸ï¼ˆæœè£…ï¼‰</li>
      <li>å©´å„¿åºŠï¼š24Ã—7.5Ã—6è‹±å¯¸ï¼Œ7.9ç£…ï¼Œåˆ†æ®µï¼šå¤§å·å¤§ä»¶</li>
      <li>æ˜¾ç¤ºå™¨ï¼š54Ã—35Ã—3.5è‹±å¯¸ï¼Œä½“ç§¯é‡é‡47.59ç£…ï¼Œåˆ†æ®µï¼šè¶…å¤§ä»¶</li>
      <li>æ¶ˆæ¯’æ¶²ï¼š12Ã—6Ã—3è‹±å¯¸ï¼Œ2ç£…ï¼Œåˆ†æ®µï¼šå¤§å·æ ‡å‡†å°ºå¯¸ï¼ˆå±é™©å“ï¼‰</li>
    </ul>
    <div style="color:#999;font-size:12px;margin-top:10px;">
      ä»¥ä¸Šå†…å®¹æ ¹æ®äºšé©¬é€Šå®˜æ–¹2025å¹´æœ€æ–°æ”¿ç­–æ•´ç†ï¼Œä»…ä¾›å‚è€ƒï¼Œæœ€æ–°è§„åˆ™ä»¥äºšé©¬é€Šå®˜æ–¹å…¬å‘Šä¸ºå‡†ã€‚
    </div>
  </div>
 <!-- è§„åˆ™ä¸è¯´æ˜åŒºå—ç»“æŸ -->

  <div class="footer">
    æœ¬å·¥å…·è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä»¥äºšé©¬é€Šå®˜æ–¹ä¸ºå‡†ã€‚<br>
    ç‰ˆæƒå½’ è·¨å¢ƒä¹è¶£å›­æ‰€æœ‰ | ä½œè€…ï¼šé”å“¥
    <br>å®˜ç½‘ï¼š<a href="https://amzlink.top/" target="_blank" rel="noopener noreferrer">https://amzlink.top/</a>
  </div>


   <script>
    // å•ä½æ¢ç®—
    function cmToInch(cm) { return cm / 2.54; }
    function gToOz(g) { return g / 28.3495; }
    function ozToLb(oz) { return oz / 16; }
    function lbToOz(lb) { return lb * 16; }
    function round2(x) { return Math.round(x * 100) / 100; }

    const feeData = {
      normal: {
        non_peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.29,2.38,2.47,2.56,2.66,2.76,2.83,2.88], mid: [3.06,3.15,3.24,3.33,3.43,3.53,3.60,3.65], high: [3.06,3.15,3.24,3.33,3.43,3.53,3.60,3.65] },
          large_standard: { pre3_steps_oz: [4,8,12,16,20,24,28,32,36,40,44,48], lt10_pre3: [2.91,3.13,3.38,3.78,4.22,4.60,4.75,5.00,5.10,5.28,5.44,5.85], mid_pre3: [3.68,3.90,4.15,4.55,4.99,5.37,5.52,5.77,5.87,6.05,6.21,6.62], high_pre3: [3.68,3.90,4.15,4.55,4.99,5.37,5.52,5.77,5.87,6.05,6.21,6.62], post3_base: { lt10: 6.15, mid: 6.92, high: 6.92 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 8.84, mid: 9.61, high: 9.61 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 8.84, mid: 9.61, high: 9.61 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 25.56, mid: 26.33, high: 26.33 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 39.35, mid: 40.12, high: 40.12 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 54.04, mid: 54.81, high: 54.81 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 194.18, mid: 194.95, high: 194.95 }, start_lb: 151, per_lb: 0.19 }
        },
        non_peak_2026: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.43,2.49,2.56,2.66,2.77,2.82,2.92,2.95], mid: [3.32,3.42,3.45,3.54,3.68,3.78,3.91,3.96], high: [3.58,3.68,3.71,3.80,3.94,4.04,4.17,4.22] },
          large_standard: { pre3_steps_oz: [4,8,12,16,20,24,28,32,36,40,44,48], lt10_pre3: [2.91,3.13,3.38,3.78,4.22,4.60,4.75,5.00,5.10,5.28,5.44,5.85], mid_pre3: [3.73,3.95,4.20,4.60,5.04,5.42,5.57,5.82,5.92,6.10,6.26,6.67], high_pre3: [3.99,4.21,4.46,4.86,5.30,5.68,5.83,6.08,6.18,6.36,6.52,6.93], post3_base: { lt10: 6.15, mid: 6.97, high: 7.23 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 6.78, mid: 7.55, high: 7.55 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 8.58, mid: 9.35, high: 9.35 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 25.56, mid: 26.33, high: 26.33 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 36.55, mid: 37.32, high: 37.32 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 50.55, mid: 51.32, high: 51.32 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 194.18, mid: 194.95, high: 194.95 }, start_lb: 151, per_lb: 0.19 }
        },
        peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.48,2.57,2.67,2.76,2.87,2.97,3.05,3.10], mid: [3.25,3.34,3.44,3.53,3.64,3.74,3.82,3.87], high: [3.25,3.34,3.44,3.53,3.64,3.74,3.82,3.87] },
          large_standard: { pre3_steps_oz: [4,8,12,16,20,24,28,32,36,40,44,48], lt10_pre3: [3.15,3.39,3.66,4.07,4.52,4.91,5.07,5.33,5.47,5.67,5.84,6.26], mid_pre3: [3.92,4.16,4.43,4.84,5.29,5.68,5.84,6.10,6.24,6.44,6.61,7.03], high_pre3: [3.92,4.16,4.43,4.84,5.29,5.68,5.84,6.10,6.24,6.44,6.61,7.03], post3_base: { lt10: 6.69, mid: 7.46, high: 7.46 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 9.88, mid: 10.65, high: 10.65 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 9.88, mid: 10.65, high: 10.65 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 28.29, mid: 29.06, high: 29.06 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 42.16, mid: 42.93, high: 42.93 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 58.46, mid: 59.23, high: 59.23 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 202.69, mid: 203.46, high: 203.46 }, start_lb: 151, per_lb: 0.19 }
        }
      },
      apparel: {
        non_peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.50,2.50,2.65,2.65,2.95,2.95,3.21,3.21], mid: [3.27,3.27,3.42,3.42,3.72,3.72,3.98,3.98], high: [3.27,3.27,3.42,3.42,3.72,3.72,3.98,3.98] },
          large_standard: { pre3_steps_oz: [4,8,12,16,24,32,40,48], lt10_pre3: [3.48,3.68,3.90,4.35,5.13,5.13,5.37,5.37], mid_pre3: [4.25,4.45,4.67,5.12,5.90,5.90,6.14,6.14], high_pre3: [4.25,4.45,4.67,5.12,5.90,5.90,6.14,6.14], post3_base: { lt10: 6.82, mid: 6.97, high: 7.63 }, post3_increment_per_half_lb: 0.16 },
          small_oversize_0_50: { base: { lt10: 8.84, mid: 9.61, high: 9.61 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 8.84, mid: 9.61, high: 9.61 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 25.56, mid: 26.33, high: 26.33 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 39.35, mid: 40.12, high: 40.12 }, start_lb: 51, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 54.04, mid: 54.81, high: 54.81 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 194.18, mid: 194.95, high: 194.95 }, start_lb: 151, per_lb: 0.19 }
        },
        non_peak_2026: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.62,2.64,2.68,2.81,3.00,3.10,3.20,3.30], mid: [3.51,3.54,3.59,3.69,3.91,4.09,4.20,4.25], high: [3.77,3.80,3.85,3.95,4.17,4.35,4.46,4.51] },
          large_standard: { pre3_steps_oz: [4,8,12,16,24,32,40,48], lt10_pre3: [3.48,3.68,3.90,4.35,5.05,5.22,5.32,5.43], mid_pre3: [4.30,4.50,4.72,5.17,5.87,6.04,6.14,6.25], high_pre3: [4.56,4.76,4.98,5.43,6.13,6.30,6.40,6.51], post3_base: { lt10: 6.78, mid: 6.97, high: 7.55 }, post3_increment_per_half_lb: 0.16 },
          small_oversize_0_50: { base: { lt10: 8.84, mid: 9.61, high: 9.61 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 8.58, mid: 9.35, high: 9.35 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 25.56, mid: 26.33, high: 26.33 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 36.55, mid: 37.32, high: 37.32 }, start_lb: 51, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 50.55, mid: 51.32, high: 51.32 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 194.18, mid: 194.95, high: 194.95 }, start_lb: 151, per_lb: 0.19 }
        },
        peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [2.73,2.73,2.90,2.90,3.22,3.22,3.50,3.50], mid: [3.50,3.50,3.67,3.67,3.99,3.99,4.27,4.27], high: [3.50,3.50,3.67,3.67,3.99,3.99,4.27,4.27] },
          large_standard: { pre3_steps_oz: [4,8,12,16,20,24,28,32,36,40,44,48], lt10_pre3: [3.79,4.00,4.23,4.69,5.50,5.50,5.76,5.76,6.27,6.27,6.50,6.50], mid_pre3: [4.56,4.77,5.00,5.46,6.27,6.27,6.53,6.53,7.04,7.04,7.27,7.27], high_pre3: [4.56,4.77,5.00,5.46,6.27,6.27,6.53,6.53,7.04,7.04,7.27,7.27], post3_base: { lt10: 6.82, mid: 7.59, high: 7.59 }, post3_increment_per_half_lb: 0.16 },
          small_oversize_0_50: { base: { lt10: 9.88, mid: 10.65, high: 10.65 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 9.88, mid: 10.65, high: 10.65 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 28.29, mid: 29.06, high: 29.06 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 42.16, mid: 42.93, high: 42.93 }, start_lb: 51, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 58.46, mid: 59.23, high: 59.23 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 202.69, mid: 203.46, high: 203.46 }, start_lb: 151, per_lb: 0.19 }
        }
      },
      danger: {
        non_peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [3.26,3.32,3.39,3.45,3.53,3.59,3.64,3.64], mid: [4.03,4.09,4.16,4.22,4.30,4.36,4.41,4.41], high: [4.03,4.09,4.16,4.22,4.30,4.36,4.41,4.41] },
          large_standard: { pre3_steps_oz: [20,24,28,32,36,40,44,48], lt10_pre3: [4.82,5.20,5.35,5.49,5.56,5.74,5.90,6.31], mid_pre3: [5.59,5.97,6.12,6.26,6.33,6.51,6.67,7.08], high_pre3: [5.59,5.97,6.12,6.26,6.33,6.51,6.67,7.08], post3_base: { lt10: 6.61, mid: 7.38, high: 7.38 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 9.56, mid: 10.33, high: 10.33 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 9.56, mid: 10.33, high: 10.33 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 27.67, mid: 28.44, high: 28.44 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 42.56, mid: 43.33, high: 43.33 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 61.17, mid: 61.94, high: 61.94 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 218.76, mid: 219.53, high: 219.53 }, start_lb: 151, per_lb: 0.19 }
        },
        non_peak_2026: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [3.40,3.43,3.48,3.55,3.64,3.65,3.73,3.73], mid: [4.29,4.36,4.37,4.43,4.55,4.61,4.72,4.72], high: [4.55,4.62,4.63,4.69,4.81,4.87,4.98,4.98] },
          large_standard: { pre3_steps_oz: [20,24,28,32,36,40,44,48], lt10_pre3: [4.82,5.20,5.35,5.49,5.56,5.74,5.90,6.31], mid_pre3: [5.64,6.02,6.17,6.31,6.38,6.56,6.72,7.13], high_pre3: [5.90,6.28,6.43,6.57,6.64,6.82,6.98,7.39], post3_base: { lt10: 6.61, mid: 7.43, high: 7.69 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 7.5, mid: 8.27, high: 8.27 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 9.3, mid: 10.07, high: 10.07 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 27.67, mid: 28.44, high: 28.44 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 39.76, mid: 40.53, high: 40.53 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 57.68, mid: 58.45, high: 58.45 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 218.76, mid: 219.53, high: 219.53 }, start_lb: 151, per_lb: 0.19 }
        },
        peak_2025: {
          small_standard: { steps: [2,4,6,8,10,12,14,16], lt10: [3.60,3.69,3.79,3.88,3.99,4.08,4.16,4.25], mid: [4.37,4.46,4.56,4.65,4.76,4.85,4.93,5.02], high: [4.37,4.46,4.56,4.65,4.76,4.85,4.93,5.02] },
          large_standard: { pre3_steps_oz: [4,8,12,16,20,24,28,32,36,40,44,48], lt10_pre3: [4.32,4.56,4.82,5.04,5.51,5.91,6.08,6.24,6.33,6.53,6.70,7.12], mid_pre3: [5.09,5.33,5.59,5.81,6.28,6.68,6.85,7.01,7.10,7.30,7.47,7.89], high_pre3: [5.09,5.33,5.59,5.81,6.28,6.68,6.85,7.01,7.10,7.30,7.47,7.89], post3_base: { lt10: 7.51, mid: 8.28, high: 8.28 }, post3_increment_per_4oz: 0.08 },
          small_oversize_0_50: { base: { lt10: 11.12, mid: 11.89, high: 11.89 }, per_lb: 0.38 },
          large_oversize_0_50: { base: { lt10: 11.12, mid: 11.89, high: 11.89 }, per_lb: 0.38 },
          super_oversize_0_50: { base: { lt10: 31.71, mid: 32.48, high: 32.48 }, per_lb: 0.38 },
          super_oversize_50_70: { base: { lt10: 46.66, mid: 47.43, high: 47.43 }, start_lb: 50, per_lb: 0.75 },
          super_oversize_70_150: { base: { lt10: 67.53, mid: 68.30, high: 68.30 }, start_lb: 71, per_lb: 0.75 },
          super_oversize_gt_150: { base: { lt10: 230.84, mid: 231.61, high: 231.61 }, start_lb: 151, per_lb: 0.19 }
        }
      }
    };

    function sort3(a, b, c) {
      let arr = [a, b, c].sort((x, y) => y - x);
      return { l: arr[0], w: arr[1], h: arr[2] };
    }

    function getTier(l, w, h, shipWeightOz) {
      const { l: L, w: W, h: H } = sort3(l, w, h);
      const sum = L + 2 * W + 2 * H;
      if (shipWeightOz <= 16 && L <= 15 && W <= 12 && H <= 0.75) return "å°å·æ ‡å‡†å°ºå¯¸";
      if (shipWeightOz <= 320 && L <= 18 && W <= 14 && H <= 8) return "å¤§å·æ ‡å‡†å°ºå¯¸";
      const weightLb = shipWeightOz / 16;
      if (weightLb > 150 || L > 108 || sum > 165) return "è¶…å¤§ä»¶";
      if (weightLb <= 70 && L <= 60 && W <= 30 && sum <= 130) return "å°å·å¤§ä»¶";
      if (weightLb <= 50 && L <= 108 && sum <= 165) return "å¤§å·å¤§ä»¶";
      return "è¶…å¤§ä»¶";
    }

    function getVolumeWeight(l, w, h) {
      let _w = Math.max(w, 2);
      let _h = Math.max(h, 2);
      let volumeLb = (l * _w * _h) / 139;
      if (volumeLb < 0) volumeLb = 0;
      return volumeLb;
    }

    function getPriceBand(price) { if (price < 10) return 'lt10'; if (price <= 50) return 'mid'; return 'high'; }
    function getSeasonKey() { const s = document.getElementById('season').value; const v = document.getElementById('version').value; if (s === 'peak') return 'peak_2025'; return v === '2026' ? 'non_peak_2026' : 'non_peak_2025'; }
    function autoDetectSeasonVersion() { const now = new Date(); const y = now.getFullYear(); const m = now.getMonth() + 1; const d = now.getDate(); const toNum = (yy,mm,dd) => yy * 10000 + mm * 100 + dd; const cur = toNum(y,m,d); const inRange = (sY,sM,sD,eY,eM,eD) => { const s = toNum(sY,sM,sD); const e = toNum(eY,eM,eD); return cur >= s && cur <= e; }; let season = 'non_peak'; let version = '2025'; if (inRange(2025,10,15,2026,1,14)) { season = 'peak'; version = '2025'; } else if (toNum(y,m,d) >= toNum(2026,1,15)) { season = 'non_peak'; version = '2026'; } else { season = 'non_peak'; version = '2025'; } document.getElementById('season').value = season; document.getElementById('version').value = version; renderCurrentFeeTable(); }
    function getFee(productType, tier, shipWeightOz, price) {
      const seasonKey = getSeasonKey();
      const dataset = feeData[productType][seasonKey];
      if (!dataset) return 'N/A';
      const band = getPriceBand(price);
      const weightLb = shipWeightOz / 16;
      if (tier === 'å°å·æ ‡å‡†å°ºå¯¸') {
        const steps = dataset.small_standard.steps;
        const fees = dataset.small_standard[band];
        for (let i = 0; i < steps.length; i++) { if (shipWeightOz <= steps[i]) return `$${fees[i].toFixed(2)}`; }
        return 'N/A';
      }
      if (tier === 'å¤§å·æ ‡å‡†å°ºå¯¸') {
        const ls = dataset.large_standard;
        const steps = ls.pre3_steps_oz;
        const fees = ls[band + '_pre3'];
        for (let i = 0; i < steps.length; i++) { if (shipWeightOz <= steps[i]) return `$${fees[i].toFixed(2)}`; }
        if (productType === 'apparel') {
          if (weightLb > 3) { const base = ls.post3_base[band]; const extra = Math.ceil((shipWeightOz - 48) / 8) * (ls.post3_increment_per_half_lb || 0); return `$${(base + extra).toFixed(2)}`; }
        } else {
          if (weightLb > 3) { const base = ls.post3_base[band]; const extra = Math.ceil((shipWeightOz - 48) / 4) * (ls.post3_increment_per_4oz || 0); return `$${(base + extra).toFixed(2)}`; }
        }
        return 'N/A';
      }
      if (tier === 'å°å·å¤§ä»¶') { const cfg = dataset.small_oversize_0_50; let fee = cfg.base[band]; if (weightLb > 1) fee += Math.ceil(weightLb - 1) * cfg.per_lb; return `$${fee.toFixed(2)}`; }
      if (tier === 'å¤§å·å¤§ä»¶') { const cfg = dataset.large_oversize_0_50; let fee = cfg.base[band]; if (weightLb > 1) fee += Math.ceil(weightLb - 1) * cfg.per_lb; return `$${fee.toFixed(2)}`; }
      if (tier === 'è¶…å¤§ä»¶') {
        if (weightLb <= 50) { const cfg = dataset.super_oversize_0_50; let fee = cfg.base[band]; if (weightLb > 1) fee += Math.ceil(weightLb - 1) * cfg.per_lb; return `$${fee.toFixed(2)}`; }
        if (weightLb <= 70) { const cfg = dataset.super_oversize_50_70; const fee = cfg.base[band] + Math.ceil(weightLb - cfg.start_lb) * cfg.per_lb; return `$${fee.toFixed(2)}`; }
        if (weightLb <= 150) { const cfg = dataset.super_oversize_70_150; const fee = cfg.base[band] + Math.ceil(weightLb - cfg.start_lb) * cfg.per_lb; return `$${fee.toFixed(2)}`; }
        const cfg = dataset.super_oversize_gt_150; const fee = cfg.base[band] + Math.ceil(weightLb - cfg.start_lb) * cfg.per_lb; return `$${fee.toFixed(2)}`;
      }
      return 'N/A';
    }

    function calculate() {
      let l = parseFloat(document.getElementById('length').value);
      let w = parseFloat(document.getElementById('width').value);
      let h = parseFloat(document.getElementById('height').value);
      let lU = document.getElementById('lengthUnit').value;
      let wU = document.getElementById('widthUnit').value;
      let hU = document.getElementById('heightUnit').value;
      let actualWeight = parseFloat(document.getElementById('actualWeight').value);
      let weightU = document.getElementById('weightUnit').value;
      let productType = document.getElementById('productType').value;
      const auto = document.getElementById('autoSeason').checked;
      if (auto) autoDetectSeasonVersion();

      if (lU === 'cm') l = cmToInch(l);
      if (wU === 'cm') w = cmToInch(w);
      if (hU === 'cm') h = cmToInch(h);

      let actualWeightOz = actualWeight;
      if (weightU === 'g') actualWeightOz = gToOz(actualWeight);
      if (weightU === 'lb') actualWeightOz = lbToOz(actualWeight);

      let volumeWeightLb = getVolumeWeight(l, w, h);
      let volumeWeightOz = volumeWeightLb * 16;

      // å°å·æ ‡å‡†å°ºå¯¸ã€è¶…å¤§ä»¶ï¼ˆ150ç£…åŠä»¥ä¸Šï¼‰åªç”¨å®é™…é‡é‡
      let tierTemp = getTier(l, w, h, actualWeightOz);
      let shipWeightOz = actualWeightOz;
      if (
        !(
          tierTemp === "å°å·æ ‡å‡†å°ºå¯¸" ||
          (tierTemp === "è¶…å¤§ä»¶" && actualWeightOz >= 2400) // 150ç£…=2400oz
        )
      ) {
        shipWeightOz = Math.max(actualWeightOz, volumeWeightOz);
      }

      let tier = getTier(l, w, h, shipWeightOz);

      // è´¹ç”¨åŒºé—´ä¸Šé™
      let weightStep = 0;
      const seasonKey = getSeasonKey();
      const dataset = feeData[productType][seasonKey];
      if (dataset) {
        if (tier === 'å°å·æ ‡å‡†å°ºå¯¸') {
          const steps = dataset.small_standard.steps;
          for (let i = 0; i < steps.length; i++) { if (shipWeightOz <= steps[i]) { weightStep = steps[i]; break; } }
          if (!weightStep) weightStep = Math.ceil(shipWeightOz / 16) * 16;
        } else if (tier === 'å¤§å·æ ‡å‡†å°ºå¯¸') {
          const steps = dataset.large_standard.pre3_steps_oz;
          for (let i = 0; i < steps.length; i++) { if (shipWeightOz <= steps[i]) { weightStep = steps[i]; break; } }
          if (!weightStep) weightStep = Math.ceil(shipWeightOz / 16) * 16;
        } else {
          weightStep = Math.ceil(shipWeightOz / 16) * 16;
        }
      }

      const priceUSD = parseFloat(document.getElementById('priceUSD').value) || 0;
      let fee = getFee(productType, tier, shipWeightOz, priceUSD);
      const feeNum = parseFloat(String(fee).replace('$','')) || 0;
      const dims = sort3(l,w,h);
      const sum = dims.l + 2*dims.w + 2*dims.h;
      const weightLb = shipWeightOz / 16;
      const surchargeSuggest = (tier === 'è¶…å¤§ä»¶' && weightLb <= 150 && (dims.l > 96 || sum > 130));
      const surchargeUSD = parseFloat(document.getElementById('surchargeUSD').value) || 0;
      const hasLithium = document.getElementById('hasLithium').checked;
      const lithiumUSD = (productType !== 'danger' && hasLithium) ? 0.11 : 0;
      const totalUSD = feeNum + surchargeUSD + lithiumUSD;

      let res = `
        <b>å°ºå¯¸æ ‡å‡†ï¼š</b> ${tier}<br>
        <b>å®é™…é‡é‡ï¼š</b> ${round2(actualWeightOz)} ç›å¸ (${round2(ozToLb(actualWeightOz))} ç£…)<br>
        <b>ä½“ç§¯é‡é‡ï¼š</b> ${round2(volumeWeightOz)} ç›å¸ (${round2(volumeWeightLb)} ç£…)<br>
        <b>é…é€é‡é‡ï¼š</b> ${round2(shipWeightOz)} ç›å¸ (${round2(ozToLb(shipWeightOz))} ç£…)<br>
        <b>é…é€é‡é‡èŒƒå›´ä¸Šé™ï¼š</b> ${weightStep} ç›å¸ (${round2(weightStep / 16)} ç£…)<br>
        <b>å”®ä»·æ¡£ä½ï¼š</b> ${getPriceBand(priceUSD) === 'lt10' ? '<$10' : getPriceBand(priceUSD) === 'mid' ? '$10~$50' : '>$50'}<br>
        <b>å­£èŠ‚ä¸ç‰ˆæœ¬ï¼š</b> ${document.getElementById('season').value === 'peak' ? 'æ—ºå­£(2025-10-15~2026-01-14)' : (document.getElementById('version').value === '2026' ? 'éæ—ºå­£(è‡ª2026-01-15èµ·)' : 'éæ—ºå­£(2025-01-15~2025-10-14)')}<br>
        <b>é…é€è´¹ç”¨ï¼š</b> ${fee}<br>
        ${surchargeSuggest ? '<span style="display:inline-block;margin-top:6px;padding:6px 8px;background:#fff3cd;border:1px solid #ffeeba;color:#856404;border-radius:4px;">æ£€æµ‹åˆ°ç‰¹å¤§å·æ¡ä»¶ï¼ˆæœ€é•¿è¾¹>96è‹±å¯¸æˆ–é•¿åº¦+å›´é•¿>130è‹±å¯¸ï¼Œä¸”â‰¤150ç£…ï¼‰ï¼Œå¯èƒ½äº§ç”Ÿé™„åŠ è´¹ã€‚</span><br>' : ''}
        <b>é”‚ç”µæ± é™„åŠ è´¹ï¼š</b> $${lithiumUSD.toFixed(2)}${(productType === 'danger' && hasLithium) ? 'ï¼ˆå±é™©å“ä¸é€‚ç”¨æ­¤é™„åŠ ï¼‰' : ''}<br>
        <b>é™„åŠ è´¹(æ‰‹åŠ¨)ï¼š</b> $${surchargeUSD.toFixed(2)}<br>
        <b>é¢„ä¼°æ€»è´¹ç”¨ï¼š</b> $${totalUSD.toFixed(2)}
        `;
      document.getElementById('result').style.display = 'block';
      document.getElementById('result').innerHTML = res;
    }

    function resetInputs() {
      document.getElementById('length').value = 0;
      document.getElementById('width').value = 0;
      document.getElementById('height').value = 0;
      document.getElementById('actualWeight').value = 0;
      document.getElementById('lengthUnit').value = 'in';
      document.getElementById('widthUnit').value = 'in';
      document.getElementById('heightUnit').value = 'in';
      document.getElementById('weightUnit').value = 'oz';
      document.getElementById('productType').value = 'normal';
      document.getElementById('priceUSD').value = 0;
      document.getElementById('season').value = 'non_peak';
      document.getElementById('version').value = '2025';
      document.getElementById('autoSeason').checked = true;
      document.getElementById('season').disabled = true;
      document.getElementById('version').disabled = true;
      document.getElementById('surchargeUSD').value = 0;
      document.getElementById('hasLithium').checked = false;
      document.getElementById('hasLithium').disabled = false;
      showFeeTab();
      document.getElementById('result').style.display = 'none';
      document.getElementById('result').innerHTML = '';
    }

    // è´¹ç”¨è¡¨tabåˆ‡æ¢
    function switchTab(type) {
      document.querySelectorAll('.tab-btns button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.fee-table').forEach(tab => tab.classList.remove('active'));
      if (type === 'normal') {
        document.querySelector('.tab-btns button:nth-child(1)').classList.add('active');
        document.getElementById('fee-normal').classList.add('active');
      } else if (type === 'apparel') {
        document.querySelector('.tab-btns button:nth-child(2)').classList.add('active');
        document.getElementById('fee-apparel').classList.add('active');
      } else if (type === 'danger') {
        document.querySelector('.tab-btns button:nth-child(3)').classList.add('active');
        document.getElementById('fee-danger').classList.add('active');
      }
      renderCurrentFeeTable();
    }

    // åˆ‡æ¢å•†å“ç±»å‹æ—¶è‡ªåŠ¨åˆ‡æ¢è´¹ç”¨tab
    function showFeeTab() {
      let type = document.getElementById('productType').value;
      switchTab(type);
      const lithiumEl = document.getElementById('hasLithium');
      if (type === 'danger') { lithiumEl.checked = false; lithiumEl.disabled = true; } else { lithiumEl.disabled = false; }
    }

    function onAutoSeasonToggle() {
      const auto = document.getElementById('autoSeason').checked;
      document.getElementById('season').disabled = auto;
      document.getElementById('version').disabled = auto;
      const ts = document.getElementById('tableSeason');
      const tv = document.getElementById('tableVersion');
      const tas = document.getElementById('tableAutoSeason');
      if (ts && tv) {
        ts.disabled = auto;
        tv.disabled = auto;
        if (auto) {
          autoDetectSeasonVersion();
          ts.value = document.getElementById('season').value;
          tv.value = document.getElementById('version').value;
        }
      }
      if (tas) tas.checked = auto;
      if (auto) autoDetectSeasonVersion();
    }

    // è·å–å½“å‰æ¿€æ´»çš„è¡¨æ ¼ç±»å‹
    function getCurrentTableType() {
      if (document.getElementById('fee-normal').classList.contains('active')) return 'normal';
      if (document.getElementById('fee-apparel').classList.contains('active')) return 'apparel';
      if (document.getElementById('fee-danger').classList.contains('active')) return 'danger';
      return 'normal';
    }

    // è·å–è¡¨æ ¼æ ‡é¢˜
    function getTableTitle(type) {
      const titles = {
        'normal': 'æ™®é€šå•†å“é…é€è´¹ç”¨è¡¨',
        'apparel': 'æœè£…é…é€è´¹ç”¨è¡¨', 
        'danger': 'å±é™©å“é…é€è´¹ç”¨è¡¨'
      };
      return titles[type] || 'é…é€è´¹ç”¨è¡¨';
    }

    // ä¸‹è½½å½“å‰è¡¨æ ¼
    function downloadCurrentTable() {
      const type = getCurrentTableType();
      const title = getTableTitle(type);
      const tableId = `fee-${type}`;
      const table = document.getElementById(tableId).querySelector('table');
      if (!table) { alert('æœªæ‰¾åˆ°è¡¨æ ¼æ•°æ®'); return; }
      let csv = '\uFEFF';
      const seasonLabel = document.getElementById('season').value === 'peak' ? 'æ—ºå­£' : 'éæ—ºå­£';
      const versionLabel = document.getElementById('version').value;
      csv += `${title} (${seasonLabel}-${versionLabel})\n\n`;
      const rows = table.querySelectorAll('tr');
      rows.forEach((row) => {
        const cells = row.querySelectorAll('th, td');
        const rowData = [];
        cells.forEach(cell => {
          let text = cell.textContent.trim();
          if (text.includes(',') || text.includes('"') || text.includes('\n')) {
            text = '"' + text.replace(/"/g, '""') + '"';
          }
          rowData.push(text);
        });
        csv += rowData.join(',') + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `${title}_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      showDownloadToast(title);
    }

    function renderCurrentFeeTable() {
      const type = getCurrentTableType();
      const seasonKey = getSeasonKey();
      const dataset = feeData[type][seasonKey];
      const container = document.getElementById(`fee-${type}`);
      if (!dataset) { container.innerHTML = '<div style="color:#888">æš‚æ— æ•°æ®</div>'; return; }
      const rows = [];
      rows.push('<table><tr><th>å°ºå¯¸åˆ†æ®µ</th><th>é‡é‡èŒƒå›´</th><th>è´¹ç”¨(<$10)</th><th>è´¹ç”¨($10~$50)</th><th>è´¹ç”¨(>$50)</th></tr>');
      const pushRow = (tier, range, lt10, mid, high) => { rows.push(`<tr><td>${tier}</td><td>${range}</td><td>$${lt10.toFixed(2)}</td><td>$${mid.toFixed(2)}</td><td>$${high.toFixed(2)}</td></tr>`); };
      const ss = dataset.small_standard;
      for (let i = 0; i < ss.steps.length; i++) {
        const range = (i === 0 ? 'â‰¤' + ss.steps[i] + 'ç›å¸' : ss.steps[i-1] + 'è‡³' + ss.steps[i] + 'ç›å¸');
        pushRow('å°å·æ ‡å‡†å°ºå¯¸', range, ss.lt10[i], ss.mid[i], ss.high[i]);
      }
      const ls = dataset.large_standard;
      for (let i = 0; i < ls.pre3_steps_oz.length; i++) {
        const prev = i === 0 ? 0 : ls.pre3_steps_oz[i-1];
        const curr = ls.pre3_steps_oz[i];
        const range = (i === 0 ? 'â‰¤' + curr + 'ç›å¸' : (prev + 'è‡³' + curr + 'ç›å¸'));
        pushRow('å¤§å·æ ‡å‡†å°ºå¯¸', range, ls.lt10_pre3[i], ls.mid_pre3[i], ls.high_pre3[i]);
      }
      if (ls.post3_base) {
        const incText = type === 'apparel' ? ` + æ¯åŠç£…$${(ls.post3_increment_per_half_lb || 0).toFixed(2)}` : ` + æ¯4ç›å¸$${(ls.post3_increment_per_4oz || 0).toFixed(2)}`;
        rows.push(`<tr><td>å¤§å·æ ‡å‡†å°ºå¯¸</td><td>3è‡³20ç£…</td><td>$${ls.post3_base.lt10.toFixed(2)}${incText}</td><td>$${ls.post3_base.mid.toFixed(2)}${incText}</td><td>$${ls.post3_base.high.toFixed(2)}${incText}</td></tr>`);
      }
      const so = dataset.small_oversize_0_50;
      if (so) rows.push(`<tr><td>å°å·å¤§ä»¶</td><td>0è‡³50ç£…</td><td>$${so.base.lt10.toFixed(2)} + æ¯ç£…$${so.per_lb.toFixed(2)}</td><td>$${so.base.mid.toFixed(2)} + æ¯ç£…$${so.per_lb.toFixed(2)}</td><td>$${so.base.high.toFixed(2)} + æ¯ç£…$${so.per_lb.toFixed(2)}</td></tr>`);
      const lo = dataset.large_oversize_0_50;
      if (lo) rows.push(`<tr><td>å¤§å·å¤§ä»¶</td><td>0è‡³50ç£…</td><td>$${lo.base.lt10.toFixed(2)} + æ¯ç£…$${lo.per_lb.toFixed(2)}</td><td>$${lo.base.mid.toFixed(2)} + æ¯ç£…$${lo.per_lb.toFixed(2)}</td><td>$${lo.base.high.toFixed(2)} + æ¯ç£…$${lo.per_lb.toFixed(2)}</td></tr>`);
      const su0 = dataset.super_oversize_0_50;
      if (su0) rows.push(`<tr><td>è¶…å¤§ä»¶</td><td>0è‡³50ç£…</td><td>$${su0.base.lt10.toFixed(2)} + æ¯ç£…$${su0.per_lb.toFixed(2)}</td><td>$${su0.base.mid.toFixed(2)} + æ¯ç£…$${su0.per_lb.toFixed(2)}</td><td>$${su0.base.high.toFixed(2)} + æ¯ç£…$${su0.per_lb.toFixed(2)}</td></tr>`);
      const su5070 = dataset.super_oversize_50_70;
      if (su5070) rows.push(`<tr><td>è¶…å¤§ä»¶</td><td>50è‡³70ç£…</td><td>$${su5070.base.lt10.toFixed(2)} + è¶…å‡ºé¦–é‡${su5070.start_lb}ç£…æ¯ç£…$${su5070.per_lb.toFixed(2)}</td><td>$${su5070.base.mid.toFixed(2)} + è¶…å‡ºé¦–é‡${su5070.start_lb}ç£…æ¯ç£…$${su5070.per_lb.toFixed(2)}</td><td>$${su5070.base.high.toFixed(2)} + è¶…å‡ºé¦–é‡${su5070.start_lb}ç£…æ¯ç£…$${su5070.per_lb.toFixed(2)}</td></tr>`);
      const su70150 = dataset.super_oversize_70_150;
      if (su70150) rows.push(`<tr><td>è¶…å¤§ä»¶</td><td>70è‡³150ç£…</td><td>$${su70150.base.lt10.toFixed(2)} + è¶…å‡ºé¦–é‡${su70150.start_lb}ç£…æ¯ç£…$${su70150.per_lb.toFixed(2)}</td><td>$${su70150.base.mid.toFixed(2)} + è¶…å‡ºé¦–é‡${su70150.start_lb}ç£…æ¯ç£…$${su70150.per_lb.toFixed(2)}</td><td>$${su70150.base.high.toFixed(2)} + è¶…å‡ºé¦–é‡${su70150.start_lb}ç£…æ¯ç£…$${su70150.per_lb.toFixed(2)}</td></tr>`);
      const su150 = dataset.super_oversize_gt_150;
      if (su150) rows.push(`<tr><td>è¶…å¤§ä»¶</td><td>è¶…è¿‡150ç£…</td><td>$${su150.base.lt10.toFixed(2)} + è¶…å‡ºé¦–é‡${su150.start_lb}ç£…æ¯ç£…$${su150.per_lb.toFixed(2)}</td><td>$${su150.base.mid.toFixed(2)} + è¶…å‡ºé¦–é‡${su150.start_lb}ç£…æ¯ç£…$${su150.per_lb.toFixed(2)}</td><td>$${su150.base.high.toFixed(2)} + è¶…å‡ºé¦–é‡${su150.start_lb}ç£…æ¯ç£…$${su150.per_lb.toFixed(2)}</td></tr>`);
      rows.push('</table>');
      container.innerHTML = rows.join('');
    }

    function onTableSeasonChange(el) {
      document.getElementById('autoSeason').checked = false;
      document.getElementById('season').disabled = false;
      document.getElementById('version').disabled = false;
      const tas = document.getElementById('tableAutoSeason');
      if (tas) tas.checked = false;
      document.getElementById('season').value = el.value;
      renderCurrentFeeTable();
    }
    function onTableVersionChange(el) {
      document.getElementById('autoSeason').checked = false;
      document.getElementById('season').disabled = false;
      document.getElementById('version').disabled = false;
      const tas = document.getElementById('tableAutoSeason');
      if (tas) tas.checked = false;
      document.getElementById('version').value = el.value;
      renderCurrentFeeTable();
    }
    function onTableAutoSeasonToggle() {
      const checked = document.getElementById('tableAutoSeason').checked;
      document.getElementById('autoSeason').checked = checked;
      onAutoSeasonToggle();
      renderCurrentFeeTable();
    }
    document.addEventListener('DOMContentLoaded', () => {
      autoDetectSeasonVersion();
      onAutoSeasonToggle();
      const ts = document.getElementById('tableSeason');
      const tv = document.getElementById('tableVersion');
      if (ts && tv) {
        ts.value = document.getElementById('season').value;
        tv.value = document.getElementById('version').value;
        ts.disabled = document.getElementById('season').disabled;
        tv.disabled = document.getElementById('version').disabled;
        const tas = document.getElementById('tableAutoSeason');
        if (tas) tas.checked = document.getElementById('autoSeason').checked;
      }
      renderCurrentFeeTable();
    });

    // æ˜¾ç¤ºä¸‹è½½æç¤º
    function showDownloadToast(title) {
      // åˆ›å»ºæç¤ºå…ƒç´ 
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 5px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 9999;
        font-size: 14px;
        opacity: 0;
        transition: opacity 0.3s ease;
      `;
      toast.textContent = `âœ… ${title} ä¸‹è½½æˆåŠŸï¼`;
      
      document.body.appendChild(toast);
      
      // æ˜¾ç¤ºåŠ¨ç”»
      setTimeout(() => {
        toast.style.opacity = '1';
      }, 100);
      
      // 3ç§’åè‡ªåŠ¨éšè—
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          if (document.body.contains(toast)) {
            document.body.removeChild(toast);
          }
        }, 300);
      }, 3000);
    }
  </script>
</body>
</html>

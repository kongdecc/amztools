<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ–‡æœ¬æ¯”è¾ƒå·¥å…·</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f5f5;
        padding: 20px;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .header {
        background: #2563eb;
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
    }

    .header h1 {
        font-size: 24px;
        margin-bottom: 8px;
    }

    .header p {
        opacity: 0.9;
        font-size: 14px;
    }

    .author {
        position: absolute;
        bottom: 10px;
        right: 20px;
        font-size: 12px;
        opacity: 0.8;
        font-style: italic;
    }

    .controls {
        padding: 20px;
        background: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        align-items: center;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .btn-primary {
        background: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background: #1d4ed8;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn-secondary:hover {
        background: #4b5563;
    }

    .btn-success {
        background: #059669;
        color: white;
    }

    .btn-success:hover {
        background: #047857;
    }

    .btn-info {
        background: #0891b2;
        color: white;
        font-size: 12px;
        padding: 8px 16px;
    }

    .btn-info:hover {
        background: #0e7490;
    }

    .help-toggle {
        margin-left: auto;
    }

    .help-panel {
        display: none;
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 6px;
        padding: 15px;
        margin: 10px 20px;
        font-size: 14px;
        line-height: 1.6;
    }

    .help-panel h3 {
        color: #92400e;
        margin-bottom: 10px;
        font-size: 16px;
    }

    .help-panel ul {
        margin-left: 20px;
        color: #78350f;
    }

    .help-panel li {
        margin-bottom: 5px;
    }

    .help-panel .shortcut {
        background: #fbbf24;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: monospace;
        font-weight: bold;
    }

    .comparison-area {
        display: flex;
        min-height: 600px;
    }

    .text-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid #e2e8f0;
    }

    .text-panel:last-child {
        border-right: none;
    }

    .panel-header {
        background: #f1f5f9;
        padding: 12px 20px;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: #475569;
    }

    .text-input {
        flex: 1;
        border: none;
        padding: 20px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
        resize: none;
        outline: none;
        background: white;
        min-height: 560px;
    }

    .result-area {
        display: none;
        flex-direction: column;
        min-height: 600px;
    }

    .result-header {
        background: #f1f5f9;
        padding: 12px 20px;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: #475569;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }

    .result-content {
        flex: 1;
        display: flex;
        min-height: 560px;
    }

    .result-panel {
        flex: 1;
        padding: 20px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
        overflow-y: auto;
        border-right: 1px solid #e2e8f0;
        white-space: pre-wrap;
        word-wrap: break-word;
        max-height: none;
    }

    .result-panel:last-child {
        border-right: none;
    }

    .added {
        background-color: #dcfce7;
        color: #166534;
        padding: 2px 4px;
        border-radius: 3px;
        display: block;
        margin: 1px 0;
    }

    .removed {
        background-color: #fee2e2;
        color: #991b1b;
        padding: 2px 4px;
        border-radius: 3px;
        text-decoration: line-through;
        display: block;
        margin: 1px 0;
    }

    .unchanged {
        color: #374151;
        display: block;
        margin: 1px 0;
    }

    .stats {
        font-size: 12px;
        color: #6b7280;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .stats span {
        white-space: nowrap;
    }

    .added-count {
        color: #059669;
    }

    .removed-count {
        color: #dc2626;
    }

    .similarity-score {
        color: #7c3aed;
        font-weight: bold;
    }

    .no-diff {
        text-align: center;
        padding: 40px;
        color: #059669;
        font-size: 18px;
        font-weight: 600;
    }

    .copy-info {
        background: #e0f2fe;
        border: 1px solid #0891b2;
        border-radius: 6px;
        padding: 10px;
        margin: 10px 20px;
        font-size: 13px;
        color: #0e7490;
        display: none;
    }

    .copy-info strong {
        color: #075985;
    }

    /* è¯¦ç»†ç»Ÿè®¡é¢æ¿ */
    .detailed-stats {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 15px;
        margin: 10px 20px;
        display: none;
    }

    .detailed-stats h3 {
        color: #374151;
        margin-bottom: 15px;
        font-size: 16px;
        text-align: center;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    .stat-category {
        background: white;
        border-radius: 6px;
        padding: 12px;
        border-left: 4px solid;
    }

    .stat-category.lines { border-left-color: #2563eb; }
    .stat-category.words { border-left-color: #059669; }
    .stat-category.chars { border-left-color: #dc2626; }

    .stat-category h4 {
        color: #374151;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        font-size: 12px;
    }

    .stat-label {
        color: #6b7280;
    }

    .stat-value {
        color: #374151;
        font-weight: 500;
    }

    @media (max-width: 768px) {
        .comparison-area, .result-content {
            flex-direction: column;
            min-height: auto;
        }
        
        .text-panel, .result-panel {
            border-right: none;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .text-input {
            height: 300px;
            min-height: 300px;
        }
        
        .result-panel {
            max-height: 400px;
            min-height: 300px;
        }

        .author {
            position: static;
            text-align: center;
            margin-top: 10px;
        }

        .help-toggle {
            margin-left: 0;
        }

        .stats {
            justify-content: center;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }
    }

    .footer {
        background: #f1f5f9;
        border-top: 1px solid #e2e8f0;
        padding: 12px 20px;
        text-align: center;
        font-size: 13px;
        color: #6b7280;
    }

    .footer a {
        color: #2563eb;
        text-decoration: none;
    }

    .footer a:hover {
        text-decoration: underline;
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>æ–‡æœ¬æ¯”è¾ƒå·¥å…·</h1>
        <p>åœ¨å·¦å³æ–‡æœ¬æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œç‚¹å‡»æ¯”è¾ƒæŒ‰é’®æŸ¥çœ‹å·®å¼‚</p>
        <div class="author">ä½œè€…ï¼šé”å“¥</div>
    </div>

    <div class="controls">
        <button class="btn btn-primary" onclick="compareTexts()">ğŸ” æ¯”è¾ƒæ–‡æœ¬</button>
        <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
        <button class="btn btn-secondary" onclick="backToEdit()">âœï¸ è¿”å›ç¼–è¾‘</button>
        <button class="btn btn-success" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
        <button class="btn btn-info" onclick="toggleDetailedStats()">ğŸ“Š è¯¦ç»†ç»Ÿè®¡</button>
        <button class="btn btn-info help-toggle" onclick="toggleHelp()">â“ ä½¿ç”¨è¯´æ˜</button>
    </div>

    <div class="help-panel" id="helpPanel">
        <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
        <ul>
            <li><strong>åŸºæœ¬æ“ä½œï¼š</strong>åœ¨å·¦å³æ–‡æœ¬æ¡†ä¸­åˆ†åˆ«è¾“å…¥åŸå§‹æ–‡æœ¬å’Œå¯¹æ¯”æ–‡æœ¬ï¼Œç‚¹å‡»"æ¯”è¾ƒæ–‡æœ¬"æŸ¥çœ‹å·®å¼‚</li>
            <li><strong>é¢œè‰²å«ä¹‰ï¼š</strong>
                <span style="background: #fee2e2; color: #991b1b; padding: 2px 4px; border-radius: 3px;">çº¢è‰²åˆ é™¤çº¿</span> = åŸæ–‡ä¸­æœ‰ä½†æ–°æ–‡ä¸­åˆ é™¤çš„å†…å®¹ï¼Œ
                <span style="background: #dcfce7; color: #166534; padding: 2px 4px; border-radius: 3px;">ç»¿è‰²èƒŒæ™¯</span> = æ–°æ–‡ä¸­æ–°å¢çš„å†…å®¹
            </li>
            <li><strong>ç›¸ä¼¼åº¦è®¡ç®—ï¼š</strong>åŸºäºè¡Œçº§åŒ¹é…ï¼Œå…¬å¼ä¸ºï¼šç›¸åŒè¡Œæ•° Ã· æœ€å¤§è¡Œæ•° Ã— 100%</li>
            <li><strong>è¯¦ç»†ç»Ÿè®¡ï¼š</strong>æä¾›è¡Œã€è¯ã€å­—ç¬¦ä¸‰ä¸ªç»´åº¦çš„è¯¦ç»†åˆ†æ</li>
            <li><strong>å¤åˆ¶åŠŸèƒ½ï¼š</strong>å°†æ¯”è¾ƒç»“æœä»¥çº¯æ–‡æœ¬æ ¼å¼å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œæ–¹ä¾¿ç²˜è´´åˆ°å…¶ä»–åœ°æ–¹</li>
            <li><strong>å¿«æ·é”®ï¼š</strong><span class="shortcut">Ctrl+Enter</span> æ¯”è¾ƒæ–‡æœ¬ï¼Œ<span class="shortcut">Ctrl+R</span> æ¸…ç©ºæ‰€æœ‰</li>
            <li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong>æ–‡æ¡£ç‰ˆæœ¬å¯¹æ¯”ã€ä»£ç å®¡æŸ¥ã€åˆåŒä¿®æ”¹ã€æ–‡ç« ç¼–è¾‘ç­‰</li>
        </ul>
    </div>

    <div class="copy-info" id="copyInfo">
        <strong>ğŸ“‹ å¤åˆ¶åŠŸèƒ½è¯´æ˜ï¼š</strong>ç‚¹å‡»"å¤åˆ¶ç»“æœ"ä¼šå°†æ¯”è¾ƒç»“æœä»¥çº¯æ–‡æœ¬æ ¼å¼å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ŒåŒ…å«æ‰€æœ‰å·®å¼‚æ ‡è®°ã€‚ä½ å¯ä»¥ç²˜è´´åˆ°è®°äº‹æœ¬ã€é‚®ä»¶æˆ–å…¶ä»–æ–‡æ¡£ä¸­ä¿å­˜æˆ–åˆ†äº«æ¯”è¾ƒç»“æœã€‚
    </div>

    <!-- è¯¦ç»†ç»Ÿè®¡é¢æ¿ -->
    <div class="detailed-stats" id="detailedStats">
        <h3>ğŸ“Š è¯¦ç»†ç»Ÿè®¡åˆ†æ</h3>
        <div class="stats-grid" id="statsGrid">
            <!-- ç»Ÿè®¡å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <div class="comparison-area" id="comparisonArea">
        <div class="text-panel">
            <div class="panel-header">åŸå§‹æ–‡æœ¬</div>
            <textarea class="text-input" id="leftText" placeholder="åœ¨æ­¤è¾“å…¥åŸå§‹æ–‡æœ¬..."></textarea>
        </div>
        <div class="text-panel">
            <div class="panel-header">å¯¹æ¯”æ–‡æœ¬</div>
            <textarea class="text-input" id="rightText" placeholder="åœ¨æ­¤è¾“å…¥è¦å¯¹æ¯”çš„æ–‡æœ¬..."></textarea>
        </div>
    </div>

    <div class="result-area" id="resultArea">
        <div class="result-header">
            <span>æ¯”è¾ƒç»“æœ</span>
            <div class="stats" id="stats"></div>
        </div>
        <div class="result-content" id="resultContent"></div>
    </div>
    <footer class="footer">
        ç‰ˆæƒå½’ è·¨å¢ƒä¹è¶£å›­æ‰€æœ‰ | å®˜ç½‘ï¼š
        <a href="https://amzlink.top/" target="_blank" rel="noopener noreferrer">https://amzlink.top/</a>
        | ä½œè€…ï¼šé”å“¥
    </footer>
</div>

<script>
    // æ”¹è¿›çš„ç›¸ä¼¼åº¦è®¡ç®—å‡½æ•°
    function calculateSimilarity(text1, text2) {
        if (text1 === text2) return 100;
        if (!text1 && !text2) return 100;
        if (!text1 || !text2) return 0;
        
        const lines1 = text1.split('\n');
        const lines2 = text2.split('\n');
        const maxLines = Math.max(lines1.length, lines2.length);
        
        if (maxLines === 0) return 100;
        
        let sameLines = 0;
        const minLines = Math.min(lines1.length, lines2.length);
        
        // è®¡ç®—å®Œå…¨ç›¸åŒçš„è¡Œæ•°
        for (let i = 0; i < minLines; i++) {
            if (lines1[i] === lines2[i]) {
                sameLines++;
            }
        }
        
        // ç›¸ä¼¼åº¦ = ç›¸åŒè¡Œæ•° / æ€»è¡Œæ•°çš„æœ€å¤§å€¼ Ã— 100%
        const similarity = (sameLines / maxLines) * 100;
        return Math.round(similarity * 10) / 10; // ä¿ç•™ä¸€ä½å°æ•°
    }

    // è¯¦ç»†ç»Ÿè®¡è®¡ç®—å‡½æ•°
    function calculateDetailedStats(text1, text2) {
        // è¡Œçº§ç»Ÿè®¡
        const lines1 = text1.split('\n');
        const lines2 = text2.split('\n');
        const maxLines = Math.max(lines1.length, lines2.length);
        const minLines = Math.min(lines1.length, lines2.length);
        
        let identicalLines = 0;
        for (let i = 0; i < minLines; i++) {
            if (lines1[i] === lines2[i]) {
                identicalLines++;
            }
        }
        
        const modifiedLines = minLines - identicalLines;
        const addedLines = lines2.length - lines1.length > 0 ? lines2.length - lines1.length : 0;
        const removedLines = lines1.length - lines2.length > 0 ? lines1.length - lines2.length : 0;
        
        // è¯çº§ç»Ÿè®¡
        const words1 = text1.match(/\S+/g) || [];
        const words2 = text2.match(/\S+/g) || [];
        const maxWords = Math.max(words1.length, words2.length);
        const minWords = Math.min(words1.length, words2.length);
        
        let identicalWords = 0;
        const words1Set = new Set(words1);
        const words2Set = new Set(words2);
        for (const word of words1Set) {
            if (words2Set.has(word)) {
                identicalWords++;
            }
        }
        
        const addedWords = words2.length - words1.length > 0 ? words2.length - words1.length : 0;
        const removedWords = words1.length - words2.length > 0 ? words1.length - words2.length : 0;
        
        // å­—ç¬¦çº§ç»Ÿè®¡
        const chars1 = text1.length;
        const chars2 = text2.length;
        const maxChars = Math.max(chars1, chars2);
        
        let identicalChars = 0;
        const minChars = Math.min(chars1, chars2);
        for (let i = 0; i < minChars; i++) {
            if (text1[i] === text2[i]) {
                identicalChars++;
            }
        }
        
        const addedChars = chars2 - chars1 > 0 ? chars2 - chars1 : 0;
        const removedChars = chars1 - chars2 > 0 ? chars1 - chars2 : 0;
        
        return {
            lines: {
                total: maxLines,
                identical: identicalLines,
                modified: modifiedLines,
                added: addedLines,
                removed: removedLines,
                similarity: maxLines > 0 ? (identicalLines / maxLines * 100).toFixed(1) : '100.0'
            },
            words: {
                total: maxWords,
                identical: identicalWords,
                modified: Math.max(0, minWords - identicalWords),
                added: addedWords,
                removed: removedWords,
                similarity: maxWords > 0 ? (identicalWords / maxWords * 100).toFixed(1) : '100.0'
            },
            chars: {
                total: maxChars,
                identical: identicalChars,
                modified: Math.max(0, minChars - identicalChars),
                added: addedChars,
                removed: removedChars,
                similarity: maxChars > 0 ? (identicalChars / maxChars * 100).toFixed(1) : '100.0'
            }
        };
    }

    // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
    function displayDetailedStats(stats) {
        const statsGrid = document.getElementById('statsGrid');
        
        statsGrid.innerHTML = `
            <div class="stat-category lines">
                <h4>ğŸ“„ è¡Œçº§åˆ†æ</h4>
                <div class="stat-item">
                    <span class="stat-label">æ€»è®¡</span>
                    <span class="stat-value">${stats.lines.total}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸åŒ</span>
                    <span class="stat-value">${stats.lines.identical} (${(stats.lines.identical / Math.max(stats.lines.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¿®æ”¹</span>
                    <span class="stat-value">${stats.lines.modified} (${(stats.lines.modified / Math.max(stats.lines.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æ–°å¢</span>
                    <span class="stat-value">${stats.lines.added} (${(stats.lines.added / Math.max(stats.lines.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">åˆ é™¤</span>
                    <span class="stat-value">${stats.lines.removed} (${(stats.lines.removed / Math.max(stats.lines.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸ä¼¼åº¦</span>
                    <span class="stat-value">${stats.lines.similarity}%</span>
                </div>
            </div>
            <div class="stat-category words">
                <h4>ğŸ“ è¯çº§åˆ†æ</h4>
                <div class="stat-item">
                    <span class="stat-label">æ€»è®¡</span>
                    <span class="stat-value">${stats.words.total}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸åŒ</span>
                    <span class="stat-value">${stats.words.identical} (${(stats.words.identical / Math.max(stats.words.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¿®æ”¹</span>
                    <span class="stat-value">${stats.words.modified} (${(stats.words.modified / Math.max(stats.words.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æ–°å¢</span>
                    <span class="stat-value">${stats.words.added} (${(stats.words.added / Math.max(stats.words.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">åˆ é™¤</span>
                    <span class="stat-value">${stats.words.removed} (${(stats.words.removed / Math.max(stats.words.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸ä¼¼åº¦</span>
                    <span class="stat-value">${stats.words.similarity}%</span>
                </div>
            </div>
            <div class="stat-category chars">
                <h4>ğŸ”¤ å­—ç¬¦åˆ†æ</h4>
                <div class="stat-item">
                    <span class="stat-label">æ€»è®¡</span>
                    <span class="stat-value">${stats.chars.total}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸åŒ</span>
                    <span class="stat-value">${stats.chars.identical} (${(stats.chars.identical / Math.max(stats.chars.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ä¿®æ”¹</span>
                    <span class="stat-value">${stats.chars.modified} (${(stats.chars.modified / Math.max(stats.chars.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æ–°å¢</span>
                    <span class="stat-value">${stats.chars.added} (${(stats.chars.added / Math.max(stats.chars.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">åˆ é™¤</span>
                    <span class="stat-value">${stats.chars.removed} (${(stats.chars.removed / Math.max(stats.chars.total, 1) * 100).toFixed(1)}%)</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">ç›¸ä¼¼åº¦</span>
                    <span class="stat-value">${stats.chars.similarity}%</span>
                </div>
            </div>
        `;
    }

    function diffTexts(text1, text2) {
        const lines1 = text1.split('\n');
        const lines2 = text2.split('\n');
        
        const result = [];
        let i = 0, j = 0;
        
        while (i < lines1.length || j < lines2.length) {
            if (i >= lines1.length) {
                result.push({ type: 'added', content: lines2[j], line1: null, line2: j + 1 });
                j++;
            } else if (j >= lines2.length) {
                result.push({ type: 'removed', content: lines1[i], line1: i + 1, line2: null });
                i++;
            } else if (lines1[i] === lines2[j]) {
                result.push({ type: 'unchanged', content: lines1[i], line1: i + 1, line2: j + 1 });
                i++;
                j++;
            } else {
                let found = false;
                for (let k = j + 1; k < Math.min(j + 5, lines2.length); k++) {
                    if (lines1[i] === lines2[k]) {
                        for (let l = j; l < k; l++) {
                            result.push({ type: 'added', content: lines2[l], line1: null, line2: l + 1 });
                        }
                        result.push({ type: 'unchanged', content: lines1[i], line1: i + 1, line2: k + 1 });
                        i++;
                        j = k + 1;
                        found = true;
                        break;
                    }
                }
                
                if (!found) {
                    for (let k = i + 1; k < Math.min(i + 5, lines1.length); k++) {
                        if (lines1[k] === lines2[j]) {
                            for (let l = i; l < k; l++) {
                                result.push({ type: 'removed', content: lines1[l], line1: l + 1, line2: null });
                            }
                            result.push({ type: 'unchanged', content: lines1[k], line1: k + 1, line2: j + 1 });
                            i = k + 1;
                            j++;
                            found = true;
                            break;
                        }
                    }
                }
                
                if (!found) {
                    result.push({ type: 'removed', content: lines1[i], line1: i + 1, line2: null });
                    result.push({ type: 'added', content: lines2[j], line1: null, line2: j + 1 });
                    i++;
                    j++;
                }
            }
        }
        
        return result;
    }

    function compareTexts() {
        const leftText = document.getElementById('leftText').value;
        const rightText = document.getElementById('rightText').value;
        
        if (!leftText.trim() && !rightText.trim()) {
            alert('è¯·è‡³å°‘åœ¨ä¸€ä¸ªæ–‡æœ¬æ¡†ä¸­è¾“å…¥å†…å®¹');
            return;
        }
        
        const similarity = calculateSimilarity(leftText, rightText);
        const detailedStats = calculateDetailedStats(leftText, rightText);
        
        // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
        displayDetailedStats(detailedStats);
        
        if (leftText === rightText) {
            showNoDifference(similarity);
            return;
        }
        
        const diff = diffTexts(leftText, rightText);
        displayDifference(diff, similarity);
    }

    function showNoDifference(similarity) {
        const comparisonArea = document.getElementById('comparisonArea');
        const resultArea = document.getElementById('resultArea');
        const resultContent = document.getElementById('resultContent');
        const stats = document.getElementById('stats');
        const copyInfo = document.getElementById('copyInfo');
        
        comparisonArea.style.display = 'none';
        resultArea.style.display = 'flex';
        copyInfo.style.display = 'block';
        
        resultContent.innerHTML = '<div class="no-diff">âœ… æ–‡æœ¬å®Œå…¨ç›¸åŒï¼Œæ²¡æœ‰å‘ç°å·®å¼‚</div>';
        stats.innerHTML = `
            <span class="added-count">æ·»åŠ : 0</span>
            <span class="removed-count">åˆ é™¤: 0</span>
            <span class="similarity-score">ç›¸ä¼¼åº¦: ${similarity}%</span>
        `;
    }

    function displayDifference(diff, similarity) {
        const comparisonArea = document.getElementById('comparisonArea');
        const resultArea = document.getElementById('resultArea');
        const resultContent = document.getElementById('resultContent');
        const stats = document.getElementById('stats');
        const copyInfo = document.getElementById('copyInfo');

        let added = 0, removed = 0;
        let leftHtml = '', rightHtml = '';

        diff.forEach(item => {
            if (item.type === 'added') {
                added++;
                leftHtml += `<span class="unchanged"></span>`;
                rightHtml += `<span class="added">${escapeHtml(item.content)}</span>`;
            } else if (item.type === 'removed') {
                removed++;
                leftHtml += `<span class="removed">${escapeHtml(item.content)}</span>`;
                rightHtml += `<span class="unchanged"></span>`;
            } else if (item.type === 'unchanged') {
                leftHtml += `<span class="unchanged">${escapeHtml(item.content)}</span>`;
                rightHtml += `<span class="unchanged">${escapeHtml(item.content)}</span>`;
            }
        });

        comparisonArea.style.display = 'none';
        resultArea.style.display = 'flex';
        copyInfo.style.display = 'block';

        resultContent.innerHTML = `
            <div class="result-panel">${leftHtml}</div>
            <div class="result-panel">${rightHtml}</div>
        `;
        stats.innerHTML = `
            <span class="added-count">æ·»åŠ : ${added}</span>
            <span class="removed-count">åˆ é™¤: ${removed}</span>
            <span class="similarity-score">ç›¸ä¼¼åº¦: ${similarity}%</span>
        `;
    }

    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/[<>&"]/g, function (c) {
            switch (c) {
                case '<': return '&lt;';
                case '>': return '&gt;';
                case '&': return '&amp;';
                case '"': return '&quot;';
            }
        });
    }

    function clearAll() {
        document.getElementById('leftText').value = '';
        document.getElementById('rightText').value = '';
        backToEdit();
    }

    function backToEdit() {
        document.getElementById('comparisonArea').style.display = 'flex';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('copyInfo').style.display = 'none';
        document.getElementById('detailedStats').style.display = 'none';
    }

    function copyResult() {
        const resultArea = document.getElementById('resultArea');
        if (resultArea.style.display === 'none') return;

        const resultContent = document.getElementById('resultContent');
        let text = '';

        // åªå¤åˆ¶å³ä¾§å¯¹æ¯”ç»“æœï¼Œå¸¦æ ‡è®°
        if (resultContent.children.length === 2) {
            const rightPanel = resultContent.children[1];
            text = Array.from(rightPanel.childNodes).map(node => {
                if (node.classList && node.classList.contains('added')) {
                    return '[æ–°å¢] ' + node.textContent;
                } else if (node.classList && node.classList.contains('unchanged')) {
                    return node.textContent;
                } else {
                    return '';
                }
            }).join('\n');
        } else {
            // æ²¡æœ‰å·®å¼‚æ—¶çš„æç¤º
            text = resultContent.textContent || '';
        }

        navigator.clipboard.writeText(text).then(() => {
            showCopyInfo();
        });
    }

    function showCopyInfo() {
        const copyInfo = document.getElementById('copyInfo');
        copyInfo.style.display = 'block';
        copyInfo.innerHTML = '<strong>âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</strong> ä½ å¯ä»¥ç²˜è´´åˆ°ä»»æ„æ–‡æ¡£æˆ–èŠå¤©çª—å£ã€‚';
        setTimeout(() => {
            copyInfo.innerHTML = '<strong>ğŸ“‹ å¤åˆ¶åŠŸèƒ½è¯´æ˜ï¼š</strong>ç‚¹å‡»"å¤åˆ¶ç»“æœ"ä¼šå°†æ¯”è¾ƒç»“æœä»¥çº¯æ–‡æœ¬æ ¼å¼å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ŒåŒ…å«æ‰€æœ‰å·®å¼‚æ ‡è®°ã€‚ä½ å¯ä»¥ç²˜è´´åˆ°è®°äº‹æœ¬ã€é‚®ä»¶æˆ–å…¶ä»–æ–‡æ¡£ä¸­ä¿å­˜æˆ–åˆ†äº«æ¯”è¾ƒç»“æœã€‚';
        }, 2000);
    }

    function toggleHelp() {
        const helpPanel = document.getElementById('helpPanel');
        helpPanel.style.display = helpPanel.style.display === 'block' ? 'none' : 'block';
    }

    function toggleDetailedStats() {
        const detailedStats = document.getElementById('detailedStats');
        detailedStats.style.display = detailedStats.style.display === 'block' ? 'none' : 'block';
    }

    // å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'Enter') {
            compareTexts();
            e.preventDefault();
        } else if (e.ctrlKey && (e.key === 'r' || e.key === 'R')) {
            clearAll();
            e.preventDefault();
        }
    });

    // åˆå§‹åŒ–
    backToEdit();
</script>
</body>
</html>
